<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-10-23">

<title>annual-qa-qc-template</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Annual QA-QC Template_files/libs/clipboard/clipboard.min.js"></script>
<script src="Annual QA-QC Template_files/libs/quarto-html/quarto.js"></script>
<script src="Annual QA-QC Template_files/libs/quarto-html/popper.min.js"></script>
<script src="Annual QA-QC Template_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Annual QA-QC Template_files/libs/quarto-html/anchor.min.js"></script>
<link href="Annual QA-QC Template_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Annual QA-QC Template_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Annual QA-QC Template_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Annual QA-QC Template_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Annual QA-QC Template_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content"><div class="quarto-title-block"><div class="quarto-title-tools-only"><h1></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>



<section id="year-qaqc" class="level1 unnumbered">
<h1 class="unnumbered">[Year] QA/QC</h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>[10/23/2024: Working to make this script in to a year-less template]</p>
<p>Prior to publishing analysis and interpretation of water quality data, we will ensure that all data that meets QA/QC standards outlined in the current project <a href="https://www.kenaiwatershed.org/news-media/qapp-revisions-completed-2023/">Quality Assurance Project Plan (QAPP)</a> and is accessible in the appropriate public repository.</p>
<p>Water quality data from this project is ultimately destined for public archival in the Environmental Protection Agency’s Water Quality Exchange (EPA WQX).</p>
<p>The QAPP for this project describes data management details and responsible parties for each step of the data pipeline from observation to repository. The 2023 data preparation and review process is published here.</p>
<section id="year-2025-water-quality-data" class="level3">
<h3 class="anchored" data-anchor-id="year-2025-water-quality-data">Year 2025 Water Quality Data</h3>
<p>In this chapter we will collate 2023 laboratory data from several sources into a single spreadsheet document with a consistent format. The desired end format is a spreadsheet template provided by the EPA Water Quality Exchange. These template files are available to download from the EPA at <a href="https://www.epa.gov/waterdata/water-quality-exchange-web-template-files" class="uri">https://www.epa.gov/waterdata/water-quality-exchange-web-template-files</a>.</p>
<p>Once the data is collated, it will be evaluated according to a Quality Assurance Checklist (template example provided by the Alaska Department of Environmental Conservation Soldotna office). Field observations that do not meet the quality assurance standards described in the evaluation checklist will be flagged as “Rejected” before being uploaded to the EPA WQX.</p>
<p>Data that has been uploaded to the EPA WQX is evaluated biannually by the Alaska Department of Environmental Conservation (ADEC) in their <a href="https://dec.alaska.gov/water/water-quality/integrated-report/">Integrated Water Quality Monitoring and Assessment Report</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. The integrated report evaluates available water quality data from the previous five years against Alaska water quality standards and regulations <span class="citation" data-cites="adec2020">[@adec2020]</span>.</p>
<section id="water-quality-data-formatting" class="level4">
<h4 class="anchored" data-anchor-id="water-quality-data-formatting">2025 Water Quality Data Formatting</h4>
<!-- -->

</section>
</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>https://dec.alaska.gov/water/water-quality/integrated-report/<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb1" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># \[Year\] QA/QC {.unnumbered}</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>execute:</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  echo: false</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>date: "<span class="in">`r Sys.Date()`</span>"</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>format:</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  html:</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    code-fold: true</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    code-tools: true</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    code-summary: "Show the code"</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, Annual WQX formatting for SGS, echo = F, message = F}</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># clear environment</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hms)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(anytime)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringi)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">pkg_load2</span>(<span class="fu">c</span>(<span class="st">"htmltools"</span>, <span class="st">"mime"</span>))</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co"># assign project year and sampling dates, un-hashtag</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>activity_year <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="st">"2025"</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>spring_sample_date <span class="ot">&lt;-</span>  <span class="fu">ymd</span>(<span class="st">"2025-05-02"</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>summer_sample_date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"2025-08-01"</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="sc">\[</span>10/23/2024: Working to make this script in to a year-less template<span class="sc">\]</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>Prior to publishing analysis and interpretation of water quality data, we will ensure that all data that meets QA/QC standards outlined in the current project <span class="co">[</span><span class="ot">Quality Assurance Project Plan (QAPP)</span><span class="co">](https://www.kenaiwatershed.org/news-media/qapp-revisions-completed-2023/)</span> and is accessible in the appropriate public repository.</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>Water quality data from this project is ultimately destined for public archival in the Environmental Protection Agency's Water Quality Exchange (EPA WQX).</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>The QAPP for this project describes data management details and responsible parties for each step of the data pipeline from observation to repository. The 2023 data preparation and review process is published here.</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="fu">### Year `r activity_year` Water Quality Data</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>In this chapter we will collate 2023 laboratory data from several sources into a single spreadsheet document with a consistent format. The desired end format is a spreadsheet template provided by the EPA Water Quality Exchange. These template files are available to download from the EPA at <span class="ot">&lt;https://www.epa.gov/waterdata/water-quality-exchange-web-template-files&gt;</span>.</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>Once the data is collated, it will be evaluated according to a Quality Assurance Checklist (template example provided by the Alaska Department of Environmental Conservation Soldotna office). Field observations that do not meet the quality assurance standards described in the evaluation checklist will be flagged as "Rejected" before being uploaded to the EPA WQX.</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>Data that has been uploaded to the EPA WQX is evaluated biannually by the Alaska Department of Environmental Conservation (ADEC) in their <span class="co">[</span><span class="ot">Integrated Water Quality Monitoring and Assessment Report</span><span class="co">](https://dec.alaska.gov/water/water-quality/integrated-report/)</span><span class="ot">[^annual-qa-qc-template-1]</span>. The integrated report evaluates available water quality data from the previous five years against Alaska water quality standards and regulations <span class="co">[</span><span class="ot">@adec2020</span><span class="co">]</span>.</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="ot">[^annual-qa-qc-template-1]: https://dec.alaska.gov/water/water-quality/integrated-report/</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="fu">#### `r activity_year` Water Quality Data Formatting</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">knit_exit</span>()</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>The code scripts in this document assemble water quality data from the two analytical laboratories that partnered with Kenai Watershed Forum for this project in 2023:</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>SGS Laboratories (Anchorage, AK)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Soldotna Wastewater Treatment Plant (Soldotna, AK)</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="fu">##### 2023 Metals/Nutrients Lab Results (SGS Labs)</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = F, message = F}</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"xfun"</span>)</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">embed_file</span>(<span class="st">'other/input/2023/spring_2023_wqx_data/Data/SGS/Revision 1 SGS Data/1231846_FC5912_Rev1_part1.csv'</span>, <span class="at">text =</span> <span class="st">"Download Original Spring 2023 Metals/Nutrients Lab Results from SGS - Part 1 - Electronic Data Delivery file"</span>)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">embed_file</span>(<span class="st">'other/input/2023/spring_2023_wqx_data/Data/SGS/Revision 1 SGS Data/1231846_FC5912_Rev1_part2.csv'</span>, <span class="at">text =</span> <span class="st">"Download Original Spring 2023 Metals/Nutrients Lab Results from SGS - Part 2 - Electronic Data Delivery file"</span>)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">embed_file</span>(<span class="st">'other/input/2023/spring_2023_wqx_data/Data/SGS/Revision 1 SGS Data/1231846_SGS_Spring_2023_data_final.pdf'</span>, <span class="at">text =</span> <span class="st">"Download Original Spring 2023 Metals/Nutrients Lab Results from SGS - PDF file"</span>)</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = F}</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">embed_file</span>(<span class="st">'other/input/2023/summer_2023_wqx_data/Data/SGS/Summer 2023 SGS Agency Baseline.xlsx'</span>, <span class="at">text =</span> <span class="st">"Download Original Summer 2023 Metals/Nutrients Lab Results from SGS - Electronic Data Delivery file"</span>)</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">embed_file</span>(<span class="st">'other/input/2023/summer_2023_wqx_data/Data/SGS/1233640.pdf'</span>, <span class="at">text =</span> <span class="st">"Download Original Summer 2023 Metals/Nutrients Lab Results from SGS - PDF file"</span>)</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">embed_file</span>(<span class="st">'other/input/2023/summer_2023_wqx_data/Data/SGS/1233640_COC.pdf'</span>, <span class="at">text =</span> <span class="st">"Download Original Summer 2023 Metals/Nutrients Chain of Custody docs from SGS - PDF file"</span>)</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE, echo = F, include = F}</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a><span class="do">############################ Part A.1: SGS 2023 Data Read In #############################</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a><span class="do">## Reformat SGS data downloaded from their server client (SGS Engage, full EDD files) to match desired template</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a><span class="co"># read in</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a><span class="co"># address column type issues such that all dataframes can be merged</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a><span class="co"># read in 200.7 results</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>spring_batch_sgs23_part1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"other/input/2023/spring_2023_wqx_data/Data/SGS/Revision 1 SGS Data/1231846_FC5912_Rev1_part1.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">PROJECT_ID =</span> <span class="fu">as.character</span>(PROJECT_ID),</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>            <span class="at">DISSOLVED =</span> <span class="fu">as.character</span>(DISSOLVED)) <span class="sc">%&gt;%</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">RUN_DATE_TIME =</span> RUN_DATE) <span class="sc">%&gt;%</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co"> the receive date/time is incomplete in this EDD. The EDD shows 5/9/23 for all project samples (sample_type = "PS") and time is not specified. We will specify samples were received at office open hours, 9:00 AM</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REC_DATE =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>    REC_DATE <span class="sc">==</span> <span class="st">"05/09/2023 00:00"</span> <span class="sc">~</span> <span class="st">"05/09/2023 09:00"</span>,</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> REC_DATE))</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a><span class="co"># read in all other results</span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>spring_batch_sgs23_part2 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"other/input/2023/spring_2023_wqx_data/Data/SGS/Revision 1 SGS Data/1231846_FC5912_Rev1_part2.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">MATRIX =</span> <span class="fu">as.character</span>(MATRIX),</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>            <span class="at">LAB_SAMPLE_ID =</span> <span class="fu">as.character</span>(LAB_SAMPLE_ID),</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>            <span class="at">SDG =</span> <span class="fu">as.character</span>(SDG))</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a><span class="co"># join parts 1 and 2 of spring 2023 results</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>spring_batch_sgs23 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(spring_batch_sgs23_part1,spring_batch_sgs23_part2)</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(spring_batch_sgs23_part1,spring_batch_sgs23_part2)</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare spring 2023 batch</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>spring_batch_sgs23 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>PROJECT_ID,<span class="sc">-</span>DISSOLVED) </span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>summer_batch_sgs23 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"other/input/2023/summer_2023_wqx_data/Data/SGS/Summer 2023 SGS Agency Baseline.xlsx"</span>, <span class="at">sheet =</span> <span class="st">"Sheet9"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>PROJECT_ID,<span class="sc">-</span>DISSOLVED) </span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: for summer 2023 results, no 200.7 results are present; all metals are 200.8. However, in the "ANALYSIS_GROUP" column, under 200.8 both "Dissolved metals by ICP/MS" AND "Metals by ICP/MS" are listed under 200.8. What gives? Check PDF</span></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a><span class="co"># discovered: </span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a><span class="co"># for summer 2023, 200.8 was used for both total and dissolved.</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a><span class="co"># 3/14/2024: for summer 2023 results, no 200.7 results are present; all metals are 200.8. However, in the "ANALYSIS_GROUP" column, under 200.8 both "Dissolved metals by ICP/MS" AND "Metals by ICP/MS" are listed under 200.8. What gives? </span></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Discovered: for summer 2023, 200.8 was used for both total and dissolved.</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a><span class="co"># later, need to address different categorical results that were in removed "DISSOLVED" column:</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; unique(spring_batch_sgs23$DISSOLVED)</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a><span class="co">#[1] TRUE</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; unique(summer_batch_sgs23$DISSOLVED)</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a><span class="co">#[1] "." "L" "T"</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a><span class="co"># joining and preparatory steps</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a><span class="do">## clean up column names and bind seasons together</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(spring_batch_sgs23,summer_batch_sgs23) <span class="sc">%&gt;%</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add lab name</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lab_name =</span> <span class="st">"SGS North America, Anchorage, Alaska"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make 'matrix' column consistent</span></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>matrix) <span class="sc">%&gt;%</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">matrix =</span> <span class="st">"Water"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prepare separate time and date columns for </span></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - sample collection</span></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - lab receipt</span></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - lab run </span></span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - extraction</span></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">collect_date =</span> <span class="fu">mdy_hm</span>(collect_date),</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>            <span class="at">rec_date =</span> <span class="fu">mdy_hm</span>(rec_date),</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>            <span class="at">run_date =</span> <span class="fu">mdy_hm</span>(run_date_time),</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>            <span class="at">extracted_date =</span> <span class="fu">mdy_hm</span>(extracted_date)) <span class="sc">%&gt;%</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(collect_date, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"collect_date"</span>,<span class="st">"collect_time"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(rec_date, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"rec_date"</span>,<span class="st">"rec_time"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(run_date_time, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"run_date_time"</span>,<span class="st">"run_time"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(extracted_date, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"extracted_date"</span>,<span class="st">"extracted_time"</span>))</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: in some past years, total metals analyses (method 200.7) have been subcontracted to ALS Laboratories (Seattle). In spring 2023, SGS Anchorage had the 200.7 methods run by SGS Orlando. Thus, these results are already read in here and not in a seperate ALS dataframe.</span></span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a><span class="co"># remove individual dataframes</span></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(spring_batch_sgs23,summer_batch_sgs23)</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a><span class="do">################### Part A.2: Create Consistent Sample Location Names for SGS data #####################</span></span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a><span class="co"># export list of unique sample_id</span></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>sgs_sitenames <span class="ot">&lt;-</span> sgs23 <span class="sc">%&gt;%</span></span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sample_type <span class="sc">==</span> <span class="st">"PS"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(sample_id)</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>sgs_sitenames <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(sample_id)</span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(sgs_sitenames,<span class="st">"other/input/2023/misc/site_names.csv"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a><span class="co"># manually edit site names csv (external to script)</span></span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a><span class="co"># read in manually edited csv</span></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>sgs_sitenames <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"other/input/2023/misc/site_names_manual_edit_sgs23.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(site_id)) <span class="sc">%&gt;%</span></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sample_id,site_id) <span class="sc">%&gt;%</span></span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove trailing spaces</span></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_id =</span> <span class="fu">str_trim</span>(sample_id, <span class="at">side =</span> <span class="st">"right"</span>))</span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(sgs_sitenames, "other/input/2023/misc/site_names_manual_edit.csv", row.names = F)</span></span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a><span class="co"># join site_id to main dataframe</span></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(sgs23,sgs_sitenames, <span class="at">by =</span> <span class="st">"sample_id"</span>)</span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a><span class="co"># join "monitoring location id" to overall sgs23 dataframe</span></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a><span class="co"># import example data w/ monitoring location IDs</span></span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>location_ids <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"other/output/example_output/results_activities_2021.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(monitoring_location_id, activity_id) <span class="sc">%&gt;%</span></span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(activity_id, <span class="at">sep =</span> <span class="st">"-"</span>, <span class="at">into =</span> <span class="st">"site_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(sgs23,location_ids, <span class="at">by =</span> <span class="st">"site_id"</span>) </span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: the join for several sites are not cooperating.</span></span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a><span class="co"># These sites include "Skilak Lake Outflow," and "Jim's Landing</span></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a><span class="co"># After investigating possible reasons, (white spaces, etc) no diagnoses are evident. </span></span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a><span class="co"># For time efficiency, we will instead manually rectify this in script with mutate and case_when</span></span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">monitoring_location_id =</span> <span class="fu">as.character</span>(monitoring_location_id)) <span class="sc">%&gt;%</span></span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Jim's Landing</span></span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">monitoring_location_id =</span> </span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>           <span class="fu">case_when</span>(</span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>             <span class="fu">grepl</span>(<span class="st">"JIM'S|Jim's"</span>,sample_id) <span class="sc">~</span> <span class="st">"10000031"</span>,</span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>             <span class="cn">TRUE</span> <span class="sc">~</span> monitoring_location_id)) <span class="sc">%&gt;%</span></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Skilak Outlet</span></span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">monitoring_location_id =</span> </span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>           <span class="fu">case_when</span>(</span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>             <span class="fu">grepl</span>(<span class="st">"Skilak|SKILAK"</span>,sample_id) <span class="sc">~</span> <span class="st">"10000030"</span>,</span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>             <span class="cn">TRUE</span> <span class="sc">~</span> monitoring_location_id))</span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a><span class="co"># all 2023 SGS data are now joined and present in same dataframe</span></span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a><span class="do">############### Part A.3: Assign miscellaneous calculated columns for 2023 SGS data (needed for next steps) ############</span></span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Type </span></span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a><span class="co"># method blank, trip blank, field duplicate)</span></span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a><span class="co"># this column is addressed out of left to right sequence because its content is needed to generate Activity ID</span></span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>  <span class="co"># designate special activity types</span></span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"DUP|Dup"</span>, sample_id) <span class="sc">~</span> <span class="st">"Quality Control Field Replicate Msr/Obs"</span>,</span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"FB|FieldBlank|FIELD BLANK"</span>, sample_id) <span class="sc">~</span> <span class="st">"Quality Control Sample-Field Blank"</span>,</span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"TRIP BLANK"</span>, sample_id) <span class="sc">~</span> <span class="st">"Quality Control Sample-Trip Blank"</span>,</span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>  <span class="co"># designate all other project samples as project samples (using CDX domain value choices)</span></span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>    sample_type <span class="sc">==</span> <span class="st">"PS"</span> <span class="sc">&amp;</span> activity_type <span class="sc">==</span> <span class="st">""</span> <span class="sc">~</span> <span class="st">"Field Msr/Obs"</span>,</span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> activity_type)) <span class="sc">%&gt;%</span></span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>  <span class="co"># designate activity type abbreviations for late use in actvity ID</span></span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_type_abbrv =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>    activity_type <span class="sc">==</span> <span class="st">"Quality Control Field Replicate Msr/Obs"</span> <span class="sc">~</span> <span class="st">"DUP"</span>,</span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>    activity_type <span class="sc">==</span> <span class="st">"Quality Control Sample-Field Blank"</span> <span class="sc">~</span> <span class="st">"FB"</span>,</span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>    activity_type <span class="sc">==</span> <span class="st">"Quality Control Sample-Trip Blank"</span> <span class="sc">~</span> <span class="st">"TB"</span>,</span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a><span class="co"># 3/14/2024: for summer 2023 results, no 200.7 results are present; all metals are 200.8. However, in the "ANALYSIS_GROUP" column, under 200.8 both "Dissolved metals by ICP/MS" AND "Metals by ICP/MS" are listed under 200.8. According to the summer 2023 PDF lab report, for summer 2023, 200.8 was used for both total and dissolved.</span></span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a><span class="co"># Action: we will use the distinction in the "ANALYSIS_GROUP" column to assign result_sample_fraction</span></span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Sample Fraction    </span></span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a><span class="co"># CDX domains: "Filtered, field," "Filtered, lab,"  "Unfiltered," "Volatile", "Total"</span></span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a><span class="co"># method SW846 6010D pertains to metal digestion and does not have reportable values. It is is included in the SGS records here as project sample ("PS") at select sites for unclear reasons. We will remove them.</span></span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(analytical_method <span class="sc">!=</span> <span class="st">"SW846 6010D"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assign by analytical method</span></span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">result_sample_fraction =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"SW8260D"</span>, analytical_method) <span class="sc">~</span> <span class="st">"Volatile"</span>,                   <span class="co"># hydrocarbons</span></span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"SM21 4500NO3-F|SM21 4500P-B,E"</span>, analytical_method) <span class="sc">~</span> <span class="st">"Total"</span>,<span class="co"># total N and P</span></span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assign by by analysis_group</span></span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unfiltered (total metals)</span></span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>    analysis_group <span class="sc">==</span> <span class="st">"Metals by ICP/MS"</span> <span class="sc">|</span></span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>      analysis_group <span class="sc">==</span> <span class="st">"Metals"</span> <span class="sc">|</span></span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>      analysis_group <span class="sc">==</span> <span class="st">"Metals by ICP/MS (Provisional for Be, Cu 06052023)"</span></span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="st">"Unfiltered"</span>,</span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>     <span class="co"># filtered (dissolved metals)</span></span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>    analysis_group <span class="sc">==</span> <span class="st">"Dissolved Metals by ICP/MS"</span> <span class="sc">|</span></span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>      analysis_group <span class="sc">==</span> <span class="st">"Diss. Metals by ICP/MS (Provisional Be,Cu 652023)"</span> </span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="st">"Filtered, lab"</span>,</span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span> )) <span class="sc">%&gt;%</span></span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>  <span class="co"># designate dissolved vs. total metals (filtered vs. unfiltered) for use in concatenating Activity ID</span></span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diss_abbrv =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>    result_sample_fraction <span class="sc">==</span> <span class="st">"Filtered, lab"</span> <span class="sc">~</span> <span class="st">"Diss"</span>,</span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span>))</span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE, echo = F, include = F}</span></span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a><span class="do">################### Part A.4: Proceed left to right across column names to calculate or assign as needed ###################</span></span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a><span class="co"># For the remainder of steps, we will conform our data to the columns present in the spreadsheet successfully uploaded with 2021 data proceeding left to right. Columns content is created in one of the following manners:</span></span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a><span class="co"># Static - column is assigned a static value</span></span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenated - column combines static info from multiple columns</span></span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculated - column is dependent on measurements</span></span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: column names marked with triple asterisk "***" are common to all dataframes, and thus are done in bulk at the end of steps that are not common to all dataframes</span></span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a><span class="co"># Project ID (static)***</span></span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitoring Location ID (static, already present)</span></span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Media Name   (static)***</span></span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Media Subdivision Name   (static)***</span></span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity ID   (concatenated) (unique identifier) (limit of X  characters)</span></span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a><span class="co"># due to CDX character limitations, we need to use abbreviations for 1) characteristic (analyte) and 2) sample type</span></span>
<span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a><span class="co"># import analyte abbreviations and join</span></span>
<span id="cb1-360"><a href="#cb1-360" aria-hidden="true" tabindex="-1"></a><span class="co"># note that surrogate organic compunds ("surr" suffix) do not have analyte abbreviations; becuase they are not project analytes</span></span>
<span id="cb1-361"><a href="#cb1-361" aria-hidden="true" tabindex="-1"></a>analyte_abbrv <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"other/input/2023/misc/analytes_list_manual_edit.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(analyte_abbreviation <span class="sc">!=</span> <span class="st">""</span>)</span>
<span id="cb1-363"><a href="#cb1-363" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(analyte_abbrv) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"analyte"</span>,<span class="st">"analyte_abbrv"</span>)</span>
<span id="cb1-364"><a href="#cb1-364" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">left_join</span>(analyte_abbrv)</span>
<span id="cb1-365"><a href="#cb1-365" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-366"><a href="#cb1-366" aria-hidden="true" tabindex="-1"></a><span class="co"># create Activity ID column</span></span>
<span id="cb1-367"><a href="#cb1-367" aria-hidden="true" tabindex="-1"></a><span class="co"># note: this step will be performed last in the sgs block, because corrections to date and/or date format may be made throughout subsequent steps here</span></span>
<span id="cb1-368"><a href="#cb1-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-369"><a href="#cb1-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-370"><a href="#cb1-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-371"><a href="#cb1-371" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Start Date   (static, specific to SGS)</span></span>
<span id="cb1-372"><a href="#cb1-372" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">activity_start_date =</span> collect_date)</span>
<span id="cb1-373"><a href="#cb1-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-374"><a href="#cb1-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-375"><a href="#cb1-375" aria-hidden="true" tabindex="-1"></a><span class="co"># make collect date consistent to 5/2/2023</span></span>
<span id="cb1-376"><a href="#cb1-376" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">activity_start_date =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-377"><a href="#cb1-377" aria-hidden="true" tabindex="-1"></a>  sample_type <span class="sc">==</span> <span class="st">"PS"</span> <span class="sc">&amp;</span> activity_start_date <span class="sc">==</span> <span class="st">"2023-05-03"</span> <span class="sc">~</span> <span class="fu">as.character</span>(spring23_sample_date),</span>
<span id="cb1-378"><a href="#cb1-378" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> activity_start_date))</span>
<span id="cb1-379"><a href="#cb1-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-380"><a href="#cb1-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-383"><a href="#cb1-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb1-384"><a href="#cb1-384" aria-hidden="true" tabindex="-1"></a><span class="co"># join near line 409 is not properly joining result_analytical_method_id for spring 2023 field blanks</span></span>
<span id="cb1-385"><a href="#cb1-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-386"><a href="#cb1-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-387"><a href="#cb1-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-388"><a href="#cb1-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-389"><a href="#cb1-389" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Start Time   (static, specific to SGS)</span></span>
<span id="cb1-390"><a href="#cb1-390" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">activity_start_time =</span> collect_time)</span>
<span id="cb1-391"><a href="#cb1-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-392"><a href="#cb1-392" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Start Time Zone***</span></span>
<span id="cb1-393"><a href="#cb1-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-394"><a href="#cb1-394" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Depth/Height Measure ***</span></span>
<span id="cb1-395"><a href="#cb1-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-396"><a href="#cb1-396" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Depth/Height Unit    ***</span></span>
<span id="cb1-397"><a href="#cb1-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-398"><a href="#cb1-398" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Comment ***</span></span>
<span id="cb1-399"><a href="#cb1-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-400"><a href="#cb1-400" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Horizontal Collection Method ***</span></span>
<span id="cb1-401"><a href="#cb1-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-402"><a href="#cb1-402" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Horizontal Reference Datum   ***</span></span>
<span id="cb1-403"><a href="#cb1-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-404"><a href="#cb1-404" aria-hidden="true" tabindex="-1"></a><span class="co"># Characteristic Name   </span></span>
<span id="cb1-405"><a href="#cb1-405" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">characteristic_name =</span> analyte)</span>
<span id="cb1-406"><a href="#cb1-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-407"><a href="#cb1-407" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Analytical Method ID,  and</span></span>
<span id="cb1-408"><a href="#cb1-408" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Analytical Method Context  </span></span>
<span id="cb1-409"><a href="#cb1-409" aria-hidden="true" tabindex="-1"></a><span class="co"># (Use table from CDX to match domain values to those names provided by SGS)</span></span>
<span id="cb1-410"><a href="#cb1-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-411"><a href="#cb1-411" aria-hidden="true" tabindex="-1"></a><span class="co"># read in table</span></span>
<span id="cb1-412"><a href="#cb1-412" aria-hidden="true" tabindex="-1"></a>analytical_methods_contexts <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"other/input/2023/misc/analytical_method_id_and_context_matching_table.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-413"><a href="#cb1-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>comments,<span class="sc">-</span>EPA.name) <span class="sc">%&gt;%</span></span>
<span id="cb1-414"><a href="#cb1-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(analytical_method <span class="sc">!=</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-415"><a href="#cb1-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">analytical_method =</span> <span class="fu">str_trim</span>(analytical_method)) <span class="co"># remove white spaces from read in table</span></span>
<span id="cb1-416"><a href="#cb1-416" aria-hidden="true" tabindex="-1"></a><span class="do">## remove white spaces from overall sgs23 dataframe</span></span>
<span id="cb1-417"><a href="#cb1-417" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">analytical_method =</span> <span class="fu">str_trim</span>(analytical_method))</span>
<span id="cb1-418"><a href="#cb1-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-419"><a href="#cb1-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-420"><a href="#cb1-420" aria-hidden="true" tabindex="-1"></a><span class="co"># join to sgs23</span></span>
<span id="cb1-421"><a href="#cb1-421" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">left_join</span>(analytical_methods_contexts)</span>
<span id="cb1-422"><a href="#cb1-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-423"><a href="#cb1-423" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Value  </span></span>
<span id="cb1-424"><a href="#cb1-424" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">result_value =</span> result)</span>
<span id="cb1-425"><a href="#cb1-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-426"><a href="#cb1-426" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Unit   </span></span>
<span id="cb1-427"><a href="#cb1-427" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">result_unit =</span> units)</span>
<span id="cb1-428"><a href="#cb1-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-429"><a href="#cb1-429" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Qualifier</span></span>
<span id="cb1-430"><a href="#cb1-430" aria-hidden="true" tabindex="-1"></a><span class="co"># options are "U"  "N"  "*N" "*"  "="  "J". Modify to ensure choices match CDX domain options.</span></span>
<span id="cb1-431"><a href="#cb1-431" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: *N" is not an option present in CDX; all other choices are. We will modify "*N" to simply "*" for simplification, for it's one instance as an MSD sample (matrix spike duplicate; non-field). Rationale: the "N" part of this qualifier is not mandatory information.</span></span>
<span id="cb1-432"><a href="#cb1-432" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb1-433"><a href="#cb1-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">result_qualifier =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-434"><a href="#cb1-434" aria-hidden="true" tabindex="-1"></a>    resultflag <span class="sc">==</span> <span class="st">"*N"</span> <span class="sc">~</span> <span class="st">"*"</span>,</span>
<span id="cb1-435"><a href="#cb1-435" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> resultflag))</span>
<span id="cb1-436"><a href="#cb1-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-437"><a href="#cb1-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-438"><a href="#cb1-438" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Weight Basis   ***</span></span>
<span id="cb1-439"><a href="#cb1-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-440"><a href="#cb1-440" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Sample Fraction    </span></span>
<span id="cb1-441"><a href="#cb1-441" aria-hidden="true" tabindex="-1"></a><span class="do">## already completed in a previous step</span></span>
<span id="cb1-442"><a href="#cb1-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-443"><a href="#cb1-443" aria-hidden="true" tabindex="-1"></a><span class="co"># Method Speciation </span></span>
<span id="cb1-444"><a href="#cb1-444" aria-hidden="true" tabindex="-1"></a><span class="do">## only some parameters in CDX require that speciation is made explicit. Following example from 2021 experience</span></span>
<span id="cb1-445"><a href="#cb1-445" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-446"><a href="#cb1-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method_speciation =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-447"><a href="#cb1-447" aria-hidden="true" tabindex="-1"></a>    result_analytical_method_id <span class="sc">==</span> <span class="st">"4500-NO3(F)"</span> <span class="sc">~</span> <span class="st">"as NO2+NO3"</span>,</span>
<span id="cb1-448"><a href="#cb1-448" aria-hidden="true" tabindex="-1"></a>    result_analytical_method_id <span class="sc">==</span> <span class="st">"4500-P-E"</span> <span class="sc">~</span> <span class="st">"as P"</span>,</span>
<span id="cb1-449"><a href="#cb1-449" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span>))</span>
<span id="cb1-450"><a href="#cb1-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-451"><a href="#cb1-451" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Value Type ***</span></span>
<span id="cb1-452"><a href="#cb1-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-453"><a href="#cb1-453" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample Collection Equipment Name ***  </span></span>
<span id="cb1-454"><a href="#cb1-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-455"><a href="#cb1-455" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Condition    </span></span>
<span id="cb1-456"><a href="#cb1-456" aria-hidden="true" tabindex="-1"></a><span class="co"># categorical choice based on result qualifier. </span></span>
<span id="cb1-457"><a href="#cb1-457" aria-hidden="true" tabindex="-1"></a><span class="co"># Attempt to use matching table generates an erroneous many-to-many join for unknown reasons, so we will instead use "case_when"</span></span>
<span id="cb1-458"><a href="#cb1-458" aria-hidden="true" tabindex="-1"></a><span class="co"># result_detection_condition &lt;- read.csv("other/input/2023/misc/result_detection_condition.csv")</span></span>
<span id="cb1-459"><a href="#cb1-459" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb1-460"><a href="#cb1-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">result_detection_condition =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-461"><a href="#cb1-461" aria-hidden="true" tabindex="-1"></a>    result_qualifier <span class="sc">==</span> <span class="st">"U"</span> <span class="sc">~</span> <span class="st">"Not Detected"</span>,</span>
<span id="cb1-462"><a href="#cb1-462" aria-hidden="true" tabindex="-1"></a>    result_qualifier <span class="sc">==</span> <span class="st">"J"</span> <span class="sc">~</span> <span class="st">"Present Below Quantification Limit"</span>,</span>
<span id="cb1-463"><a href="#cb1-463" aria-hidden="true" tabindex="-1"></a>    result_qualifier <span class="sc">==</span> <span class="st">"N"</span> <span class="sc">~</span> <span class="st">"Presumptive evidence of a nontarget compound"</span>,</span>
<span id="cb1-464"><a href="#cb1-464" aria-hidden="true" tabindex="-1"></a>    result_qualifier <span class="sc">==</span> <span class="st">"*"</span> <span class="sc">~</span> <span class="st">"Sample was warm when received"</span>))</span>
<span id="cb1-465"><a href="#cb1-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-466"><a href="#cb1-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-467"><a href="#cb1-467" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Status ID  (make as very last step?)</span></span>
<span id="cb1-468"><a href="#cb1-468" aria-hidden="true" tabindex="-1"></a><span class="co"># decision made after QA/QC process</span></span>
<span id="cb1-469"><a href="#cb1-469" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TBD</span><span class="co"> work to be completed here &lt;--------------------------------------------</span></span>
<span id="cb1-470"><a href="#cb1-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-471"><a href="#cb1-471" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: the acronyms &amp; terminology for detection limits provided by SGS differ slightly from those required by CDX</span></span>
<span id="cb1-472"><a href="#cb1-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-473"><a href="#cb1-473" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Type 1 </span></span>
<span id="cb1-474"><a href="#cb1-474" aria-hidden="true" tabindex="-1"></a><span class="co"># Lower Quantitation Limit (listed as "loq", or "Limit of Quantitation")</span></span>
<span id="cb1-475"><a href="#cb1-475" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_type_1 =</span> <span class="st">"Lower Quantitation Limit"</span>)</span>
<span id="cb1-476"><a href="#cb1-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-477"><a href="#cb1-477" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Value 1    </span></span>
<span id="cb1-478"><a href="#cb1-478" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">result_detection_limit_value_1 =</span> loq)</span>
<span id="cb1-479"><a href="#cb1-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-480"><a href="#cb1-480" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Unit 1 </span></span>
<span id="cb1-481"><a href="#cb1-481" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_unit_1 =</span> result_unit)</span>
<span id="cb1-482"><a href="#cb1-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-483"><a href="#cb1-483" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Type 2 </span></span>
<span id="cb1-484"><a href="#cb1-484" aria-hidden="true" tabindex="-1"></a><span class="co"># Method Detection Level (listed as "lod", or "limit of detection")</span></span>
<span id="cb1-485"><a href="#cb1-485" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_type_2 =</span> <span class="st">"Method Detection Level"</span>)</span>
<span id="cb1-486"><a href="#cb1-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-487"><a href="#cb1-487" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Value 2    </span></span>
<span id="cb1-488"><a href="#cb1-488" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">result_detection_limit_value_2 =</span> lod)</span>
<span id="cb1-489"><a href="#cb1-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-490"><a href="#cb1-490" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Unit 2 </span></span>
<span id="cb1-491"><a href="#cb1-491" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_unit_2 =</span> result_unit)</span>
<span id="cb1-492"><a href="#cb1-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-493"><a href="#cb1-493" aria-hidden="true" tabindex="-1"></a><span class="co"># Laboratory Name   </span></span>
<span id="cb1-494"><a href="#cb1-494" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">laboratory_name  =</span> <span class="st">"SGS North America, Anchorage, Alaska"</span>)</span>
<span id="cb1-495"><a href="#cb1-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-496"><a href="#cb1-496" aria-hidden="true" tabindex="-1"></a><span class="co"># Laboratory Comment Text   </span></span>
<span id="cb1-497"><a href="#cb1-497" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TBD</span></span>
<span id="cb1-498"><a href="#cb1-498" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">lab_comment_text =</span> <span class="st">""</span>)</span>
<span id="cb1-499"><a href="#cb1-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-500"><a href="#cb1-500" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis Start Date   </span></span>
<span id="cb1-501"><a href="#cb1-501" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">analysis_start_date =</span> run_date_time)</span>
<span id="cb1-502"><a href="#cb1-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-503"><a href="#cb1-503" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis Start Time   </span></span>
<span id="cb1-504"><a href="#cb1-504" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">analysis_start_time =</span> run_time)</span>
<span id="cb1-505"><a href="#cb1-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-506"><a href="#cb1-506" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis Start Time Zone (can vary by year if subcontract lab used)</span></span>
<span id="cb1-507"><a href="#cb1-507" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">analysis_start_time_zone =</span> <span class="st">"AKST"</span>)</span>
<span id="cb1-508"><a href="#cb1-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-509"><a href="#cb1-509" aria-hidden="true" tabindex="-1"></a><span class="co"># Thermal Preservative Used ***</span></span>
<span id="cb1-510"><a href="#cb1-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-511"><a href="#cb1-511" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample Container Type </span></span>
<span id="cb1-512"><a href="#cb1-512" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb1-513"><a href="#cb1-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_container_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-514"><a href="#cb1-514" aria-hidden="true" tabindex="-1"></a>  result_analytical_method_id <span class="sc">==</span> <span class="st">"8260D"</span> <span class="sc">~</span> <span class="st">"Glass Vial"</span>,</span>
<span id="cb1-515"><a href="#cb1-515" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Plastic Bottle"</span>))</span>
<span id="cb1-516"><a href="#cb1-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-517"><a href="#cb1-517" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample Container Color</span></span>
<span id="cb1-518"><a href="#cb1-518" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb1-519"><a href="#cb1-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_container_color =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-520"><a href="#cb1-520" aria-hidden="true" tabindex="-1"></a>  result_analytical_method_id <span class="sc">==</span> <span class="st">"8260D"</span> <span class="sc">~</span> <span class="st">"Amber"</span>,</span>
<span id="cb1-521"><a href="#cb1-521" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Opaque"</span>))</span>
<span id="cb1-522"><a href="#cb1-522" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-523"><a href="#cb1-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-524"><a href="#cb1-524" aria-hidden="true" tabindex="-1"></a><span class="co"># Chemical Preservative Used </span></span>
<span id="cb1-525"><a href="#cb1-525" aria-hidden="true" tabindex="-1"></a><span class="co"># note that 200.8 samples were lab-filtered in spring &amp; summer 2023, so no field preservative was used (would normally be HNO3 for year prior to 2022)</span></span>
<span id="cb1-526"><a href="#cb1-526" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb1-527"><a href="#cb1-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chemical_preservative_used =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-528"><a href="#cb1-528" aria-hidden="true" tabindex="-1"></a>      result_analytical_method_id <span class="sc">==</span> <span class="st">"8260D"</span> <span class="sc">~</span> <span class="st">"HCl"</span>,</span>
<span id="cb1-529"><a href="#cb1-529" aria-hidden="true" tabindex="-1"></a>      result_analytical_method_id <span class="sc">==</span> <span class="st">"4500-NO3(F)"</span> <span class="sc">~</span> <span class="st">"H2SO4"</span>,</span>
<span id="cb1-530"><a href="#cb1-530" aria-hidden="true" tabindex="-1"></a>      result_analytical_method_id <span class="sc">==</span> <span class="st">"4500-P-E"</span> <span class="sc">~</span> <span class="st">"H2SO4"</span>,</span>
<span id="cb1-531"><a href="#cb1-531" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span>))</span>
<span id="cb1-532"><a href="#cb1-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-533"><a href="#cb1-533" aria-hidden="true" tabindex="-1"></a><span class="co"># create Activity ID column</span></span>
<span id="cb1-534"><a href="#cb1-534" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-535"><a href="#cb1-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_id =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-536"><a href="#cb1-536" aria-hidden="true" tabindex="-1"></a>    activity_type_abbrv <span class="sc">==</span> <span class="st">""</span> <span class="sc">~</span> <span class="fu">paste0</span>(site_id,<span class="st">"-"</span>,activity_start_date,<span class="st">"-"</span>,analyte_abbrv),</span>
<span id="cb1-537"><a href="#cb1-537" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">paste0</span>(site_id,<span class="st">"-"</span>,activity_start_date,<span class="st">"-"</span>,analyte_abbrv,<span class="st">"-"</span>,activity_type_abbrv))) <span class="sc">%&gt;%</span></span>
<span id="cb1-538"><a href="#cb1-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_id =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-539"><a href="#cb1-539" aria-hidden="true" tabindex="-1"></a>    diss_abbrv <span class="sc">==</span> <span class="st">""</span> <span class="sc">~</span> activity_id,</span>
<span id="cb1-540"><a href="#cb1-540" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">paste0</span>(activity_id,<span class="st">"-"</span>,diss_abbrv)))</span>
<span id="cb1-541"><a href="#cb1-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-542"><a href="#cb1-542" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnosing</span></span>
<span id="cb1-543"><a href="#cb1-543" aria-hidden="true" tabindex="-1"></a><span class="co">#z &lt;- sgs23 %&gt;%</span></span>
<span id="cb1-544"><a href="#cb1-544" aria-hidden="true" tabindex="-1"></a><span class="co">#  filter(characteristic_name == "Iron",</span></span>
<span id="cb1-545"><a href="#cb1-545" aria-hidden="true" tabindex="-1"></a><span class="co">#         sample_type == "PS")</span></span>
<span id="cb1-546"><a href="#cb1-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-547"><a href="#cb1-547" aria-hidden="true" tabindex="-1"></a><span class="co"># see: lab_sample_id = 1233640028 has collect date in spring and receive date in summer. fix me ( no error encountered 7/12/2024)</span></span>
<span id="cb1-548"><a href="#cb1-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-549"><a href="#cb1-549" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-550"><a href="#cb1-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-551"><a href="#cb1-551" aria-hidden="true" tabindex="-1"></a>--<span class="sc">\&gt;</span> use EPA metals guidance in QA/QC rather than at this stage!</span>
<span id="cb1-552"><a href="#cb1-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-553"><a href="#cb1-553" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb1-554"><a href="#cb1-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-555"><a href="#cb1-555" aria-hidden="true" tabindex="-1"></a><span class="fu">##### 2023 Fecal Coliform Lab Results (Soldotna Wastewater Treatment Plant Lab)</span></span>
<span id="cb1-556"><a href="#cb1-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-557"><a href="#cb1-557" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE, echo = F, include = F}</span></span>
<span id="cb1-558"><a href="#cb1-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-559"><a href="#cb1-559" aria-hidden="true" tabindex="-1"></a><span class="do">######################### Part B: SWWTP Fecal Coliform Data ############################</span></span>
<span id="cb1-560"><a href="#cb1-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-561"><a href="#cb1-561" aria-hidden="true" tabindex="-1"></a><span class="co"># spring</span></span>
<span id="cb1-562"><a href="#cb1-562" aria-hidden="true" tabindex="-1"></a>spring_23_fc_dir <span class="ot">&lt;-</span> <span class="st">"other/input/2023/spring_2023_wqx_data/Data/SWWTP/KRWF Fecal 05-02-23.xlsx"</span></span>
<span id="cb1-563"><a href="#cb1-563" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">embed_file</span>(spring_23_fc_dir, <span class="at">text =</span> <span class="st">"Download Original Spring 2023 Fecal Coliform Lab Results from SWWTP"</span>)</span>
<span id="cb1-564"><a href="#cb1-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-565"><a href="#cb1-565" aria-hidden="true" tabindex="-1"></a><span class="co"># summer</span></span>
<span id="cb1-566"><a href="#cb1-566" aria-hidden="true" tabindex="-1"></a>summer_23_fc_dir <span class="ot">&lt;-</span> <span class="st">"other/input/2023/summer_2023_wqx_data/Data/SWWTP/KRWF Fecal 07-18-23.xlsx"</span></span>
<span id="cb1-567"><a href="#cb1-567" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">embed_file</span>(summer_23_fc_dir, <span class="at">text =</span> <span class="st">"Download Original Summer 2023 Fecal Coliform Lab Results from SWWTP"</span>)</span>
<span id="cb1-568"><a href="#cb1-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-569"><a href="#cb1-569" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-570"><a href="#cb1-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-571"><a href="#cb1-571" aria-hidden="true" tabindex="-1"></a>Chain of custody documents available upon request.</span>
<span id="cb1-572"><a href="#cb1-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-573"><a href="#cb1-573" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE, echo = F, include = F}</span></span>
<span id="cb1-574"><a href="#cb1-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-575"><a href="#cb1-575" aria-hidden="true" tabindex="-1"></a><span class="do">############################ Part B.1: SWWTP Fecal Coliform Data Read In #############################</span></span>
<span id="cb1-576"><a href="#cb1-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-577"><a href="#cb1-577" aria-hidden="true" tabindex="-1"></a><span class="co"># spring</span></span>
<span id="cb1-578"><a href="#cb1-578" aria-hidden="true" tabindex="-1"></a>spring_23_fc <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(spring_23_fc_dir, <span class="at">skip =</span> <span class="dv">11</span>, <span class="at">col_types =</span> <span class="st">"text"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-579"><a href="#cb1-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rec_date =</span> spring23_sample_date) </span>
<span id="cb1-580"><a href="#cb1-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-581"><a href="#cb1-581" aria-hidden="true" tabindex="-1"></a><span class="co"># summer</span></span>
<span id="cb1-582"><a href="#cb1-582" aria-hidden="true" tabindex="-1"></a>summer_23_fc <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(summer_23_fc_dir, <span class="at">skip =</span> <span class="dv">11</span>, <span class="at">col_types =</span> <span class="st">"text"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-583"><a href="#cb1-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rec_date =</span> summer23_sample_date)</span>
<span id="cb1-584"><a href="#cb1-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-585"><a href="#cb1-585" aria-hidden="true" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb1-586"><a href="#cb1-586" aria-hidden="true" tabindex="-1"></a>fc23 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(spring_23_fc,summer_23_fc) <span class="sc">%&gt;%</span></span>
<span id="cb1-587"><a href="#cb1-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-588"><a href="#cb1-588" aria-hidden="true" tabindex="-1"></a>  <span class="co"># standardize time formats</span></span>
<span id="cb1-589"><a href="#cb1-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_sampled =</span> <span class="fu">format</span>(<span class="fu">as.POSIXct</span>(<span class="fu">Sys.Date</span>() <span class="sc">+</span> <span class="fu">as.numeric</span>(time_sampled)), <span class="st">"%H:%M"</span>, <span class="at">tz=</span><span class="st">"UTC"</span>),</span>
<span id="cb1-590"><a href="#cb1-590" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_in =</span> <span class="fu">format</span>(<span class="fu">as.POSIXct</span>(<span class="fu">Sys.Date</span>() <span class="sc">+</span> <span class="fu">as.numeric</span>(time_in)), <span class="st">"%H:%M"</span>, <span class="at">tz=</span><span class="st">"UTC"</span>),</span>
<span id="cb1-591"><a href="#cb1-591" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_out =</span> <span class="fu">format</span>(<span class="fu">as.POSIXct</span>(<span class="fu">Sys.Date</span>() <span class="sc">+</span> <span class="fu">as.numeric</span>(time_out)), <span class="st">"%H:%M"</span>, <span class="at">tz=</span><span class="st">"UTC"</span>),</span>
<span id="cb1-592"><a href="#cb1-592" aria-hidden="true" tabindex="-1"></a>         <span class="at">rec_time =</span> <span class="fu">format</span>(<span class="fu">as.POSIXct</span>(<span class="fu">Sys.Date</span>() <span class="sc">+</span> <span class="fu">as.numeric</span>(rec_time)), <span class="st">"%H:%M"</span>, <span class="at">tz=</span><span class="st">"UTC"</span>))</span>
<span id="cb1-593"><a href="#cb1-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-594"><a href="#cb1-594" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-595"><a href="#cb1-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-596"><a href="#cb1-596" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-597"><a href="#cb1-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-598"><a href="#cb1-598" aria-hidden="true" tabindex="-1"></a><span class="do">################### Part B.2: Create Consistent Sample Location Names for SWWTP FC data #####################</span></span>
<span id="cb1-599"><a href="#cb1-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-600"><a href="#cb1-600" aria-hidden="true" tabindex="-1"></a><span class="co"># execute once and manually modify csv to create match table</span></span>
<span id="cb1-601"><a href="#cb1-601" aria-hidden="true" tabindex="-1"></a><span class="co"># z &lt;- sgs23 %&gt;%</span></span>
<span id="cb1-602"><a href="#cb1-602" aria-hidden="true" tabindex="-1"></a><span class="co">#  select(site_id,monitoring_location_id) %&gt;%</span></span>
<span id="cb1-603"><a href="#cb1-603" aria-hidden="true" tabindex="-1"></a><span class="co">#  distinct()</span></span>
<span id="cb1-604"><a href="#cb1-604" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(z,"other/input/2023/misc/site_names_manual_edit_fc23.csv", row.names = F)</span></span>
<span id="cb1-605"><a href="#cb1-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-606"><a href="#cb1-606" aria-hidden="true" tabindex="-1"></a><span class="co"># read in fc sites</span></span>
<span id="cb1-607"><a href="#cb1-607" aria-hidden="true" tabindex="-1"></a>fc23_site_names <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"other/input/2023/misc/site_names_manual_edit_fc23.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-608"><a href="#cb1-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>()</span>
<span id="cb1-609"><a href="#cb1-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-610"><a href="#cb1-610" aria-hidden="true" tabindex="-1"></a><span class="co"># join to fecal coliform data frame</span></span>
<span id="cb1-611"><a href="#cb1-611" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">left_join</span>(fc23_site_names)</span>
<span id="cb1-612"><a href="#cb1-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-613"><a href="#cb1-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-614"><a href="#cb1-614" aria-hidden="true" tabindex="-1"></a><span class="do">############### Part B.3: Assign miscellaneous columns for 2023 SWWTP FC (needed for next steps) ###############</span></span>
<span id="cb1-615"><a href="#cb1-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-616"><a href="#cb1-616" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Type </span></span>
<span id="cb1-617"><a href="#cb1-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-618"><a href="#cb1-618" aria-hidden="true" tabindex="-1"></a><span class="co"># method blank, trip blank, field duplicate)</span></span>
<span id="cb1-619"><a href="#cb1-619" aria-hidden="true" tabindex="-1"></a><span class="co"># this column is addressed out of left to right sequence because its content is needed to generate Activity ID</span></span>
<span id="cb1-620"><a href="#cb1-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-621"><a href="#cb1-621" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-622"><a href="#cb1-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-623"><a href="#cb1-623" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"DUP"</span>, sample_location_rm) <span class="sc">~</span> <span class="st">"Quality Control Field Replicate Msr/Obs"</span>,</span>
<span id="cb1-624"><a href="#cb1-624" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"BLANK"</span>, sample_location_rm) <span class="sc">~</span> <span class="st">"Quality Control Sample-Lab Blank"</span>,</span>
<span id="cb1-625"><a href="#cb1-625" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"POSITIVE"</span>, sample_location_rm) <span class="sc">~</span> <span class="st">"Sample-Positive Control"</span>,</span>
<span id="cb1-626"><a href="#cb1-626" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Field Msr/Obs"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-627"><a href="#cb1-627" aria-hidden="true" tabindex="-1"></a><span class="co"># designate activity type abbreviations for late use in actvity ID</span></span>
<span id="cb1-628"><a href="#cb1-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_type_abbrv =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-629"><a href="#cb1-629" aria-hidden="true" tabindex="-1"></a>    activity_type <span class="sc">==</span> <span class="st">"Quality Control Field Replicate Msr/Obs"</span> <span class="sc">~</span> <span class="st">"DUP"</span>,</span>
<span id="cb1-630"><a href="#cb1-630" aria-hidden="true" tabindex="-1"></a>    activity_type <span class="sc">==</span> <span class="st">"Quality Control Sample-Lab Blank"</span> <span class="sc">~</span> <span class="st">"LB"</span>,</span>
<span id="cb1-631"><a href="#cb1-631" aria-hidden="true" tabindex="-1"></a>    activity_type <span class="sc">==</span> <span class="st">"Sample-Positive Control"</span> <span class="sc">~</span> <span class="st">"POS"</span>,</span>
<span id="cb1-632"><a href="#cb1-632" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span>))</span>
<span id="cb1-633"><a href="#cb1-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-634"><a href="#cb1-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-635"><a href="#cb1-635" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Sample Fraction    </span></span>
<span id="cb1-636"><a href="#cb1-636" aria-hidden="true" tabindex="-1"></a><span class="co"># CDX domains: none used in 2021 example</span></span>
<span id="cb1-637"><a href="#cb1-637" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_sample_fraction =</span> <span class="st">""</span>)</span>
<span id="cb1-638"><a href="#cb1-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-639"><a href="#cb1-639" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect Date</span></span>
<span id="cb1-640"><a href="#cb1-640" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">collect_date =</span> rec_date)</span>
<span id="cb1-641"><a href="#cb1-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-642"><a href="#cb1-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-643"><a href="#cb1-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-644"><a href="#cb1-644" aria-hidden="true" tabindex="-1"></a><span class="do">################### Part B.4: Proceed left to right across column names to calculate as needed #####################</span></span>
<span id="cb1-645"><a href="#cb1-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-646"><a href="#cb1-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-647"><a href="#cb1-647" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: column names marked with triple asterisk "***" are common to all dataframes, and thus are done in bulk at the end of steps that are not common to all dataframes</span></span>
<span id="cb1-648"><a href="#cb1-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-649"><a href="#cb1-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-650"><a href="#cb1-650" aria-hidden="true" tabindex="-1"></a><span class="co"># Project ID (static)***</span></span>
<span id="cb1-651"><a href="#cb1-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-652"><a href="#cb1-652" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitoring Location ID (static, already present)</span></span>
<span id="cb1-653"><a href="#cb1-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-654"><a href="#cb1-654" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Media Name   (static)***</span></span>
<span id="cb1-655"><a href="#cb1-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-656"><a href="#cb1-656" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Media Subdivision Name   (static)***</span></span>
<span id="cb1-657"><a href="#cb1-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-658"><a href="#cb1-658" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity ID   (concatenated) (unique identifier) (limit of X  characters)</span></span>
<span id="cb1-659"><a href="#cb1-659" aria-hidden="true" tabindex="-1"></a><span class="co"># due to CDX character limitations, we need to use abbreviations for 1) characteristic (analyte) and 2) sample type</span></span>
<span id="cb1-660"><a href="#cb1-660" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">analyte_abbrv =</span> <span class="st">"FC"</span>)</span>
<span id="cb1-661"><a href="#cb1-661" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-662"><a href="#cb1-662" aria-hidden="true" tabindex="-1"></a><span class="co"># create Activity ID column</span></span>
<span id="cb1-663"><a href="#cb1-663" aria-hidden="true" tabindex="-1"></a><span class="co"># note: this step will be performed last in the tss block, because corrections to date and/or date format may be made throughout subsequent steps here</span></span>
<span id="cb1-664"><a href="#cb1-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-665"><a href="#cb1-665" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-666"><a href="#cb1-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-667"><a href="#cb1-667" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Start Date   </span></span>
<span id="cb1-668"><a href="#cb1-668" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">activity_start_date =</span> collect_date)</span>
<span id="cb1-669"><a href="#cb1-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-670"><a href="#cb1-670" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Start Time   (static, specific to SGS)</span></span>
<span id="cb1-671"><a href="#cb1-671" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">activity_start_time =</span> time_sampled)</span>
<span id="cb1-672"><a href="#cb1-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-673"><a href="#cb1-673" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Start Time Zone***</span></span>
<span id="cb1-674"><a href="#cb1-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-675"><a href="#cb1-675" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Depth/Height Measure ***</span></span>
<span id="cb1-676"><a href="#cb1-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-677"><a href="#cb1-677" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Depth/Height Unit    ***</span></span>
<span id="cb1-678"><a href="#cb1-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-679"><a href="#cb1-679" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Comment ***</span></span>
<span id="cb1-680"><a href="#cb1-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-681"><a href="#cb1-681" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Horizontal Collection Method ***</span></span>
<span id="cb1-682"><a href="#cb1-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-683"><a href="#cb1-683" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Horizontal Reference Datum   ***</span></span>
<span id="cb1-684"><a href="#cb1-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-685"><a href="#cb1-685" aria-hidden="true" tabindex="-1"></a><span class="co"># Characteristic Name   </span></span>
<span id="cb1-686"><a href="#cb1-686" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">characteristic_name =</span> <span class="st">"Fecal Coliform"</span>)</span>
<span id="cb1-687"><a href="#cb1-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-688"><a href="#cb1-688" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Analytical Method ID,  and</span></span>
<span id="cb1-689"><a href="#cb1-689" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Analytical Method Context  </span></span>
<span id="cb1-690"><a href="#cb1-690" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-691"><a href="#cb1-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">result_analytical_method_id =</span> <span class="st">"9222D"</span>,</span>
<span id="cb1-692"><a href="#cb1-692" aria-hidden="true" tabindex="-1"></a>         <span class="at">result_analytical_method_context =</span> <span class="st">"APHA"</span>)</span>
<span id="cb1-693"><a href="#cb1-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-694"><a href="#cb1-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-695"><a href="#cb1-695" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Value  </span></span>
<span id="cb1-696"><a href="#cb1-696" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">result_value =</span> colony_count_100m_l)</span>
<span id="cb1-697"><a href="#cb1-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-698"><a href="#cb1-698" aria-hidden="true" tabindex="-1"></a> <span class="co"># Result Unit  </span></span>
<span id="cb1-699"><a href="#cb1-699" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_unit =</span> <span class="st">"cfu/100ml"</span>)</span>
<span id="cb1-700"><a href="#cb1-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-701"><a href="#cb1-701" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Qualifier</span></span>
<span id="cb1-702"><a href="#cb1-702" aria-hidden="true" tabindex="-1"></a><span class="co"># Use "=" if result &gt; 1 and "U" if result &lt; 1. See pg 17 of 2020 QAPP at "other/documents/QAPP/QAPP-2020-KenaiRiverWatershed_ZnCu.pdf" in Appendix A of comprehensive report</span></span>
<span id="cb1-703"><a href="#cb1-703" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-704"><a href="#cb1-704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">result_qualifier =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-705"><a href="#cb1-705" aria-hidden="true" tabindex="-1"></a>    result_value <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"U"</span>,</span>
<span id="cb1-706"><a href="#cb1-706" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"="</span>))</span>
<span id="cb1-707"><a href="#cb1-707" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-708"><a href="#cb1-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-709"><a href="#cb1-709" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Weight Basis   ***</span></span>
<span id="cb1-710"><a href="#cb1-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-711"><a href="#cb1-711" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Sample Fraction    </span></span>
<span id="cb1-712"><a href="#cb1-712" aria-hidden="true" tabindex="-1"></a><span class="do">## already completed in a previous step</span></span>
<span id="cb1-713"><a href="#cb1-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-714"><a href="#cb1-714" aria-hidden="true" tabindex="-1"></a><span class="co"># Method Speciation </span></span>
<span id="cb1-715"><a href="#cb1-715" aria-hidden="true" tabindex="-1"></a><span class="co"># not applicable to fecal coliform</span></span>
<span id="cb1-716"><a href="#cb1-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-717"><a href="#cb1-717" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Value Type ***</span></span>
<span id="cb1-718"><a href="#cb1-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-719"><a href="#cb1-719" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample Collection Equipment Name ***  </span></span>
<span id="cb1-720"><a href="#cb1-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-721"><a href="#cb1-721" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Condition    </span></span>
<span id="cb1-722"><a href="#cb1-722" aria-hidden="true" tabindex="-1"></a><span class="co"># categorical choice based on result qualifier. </span></span>
<span id="cb1-723"><a href="#cb1-723" aria-hidden="true" tabindex="-1"></a><span class="co"># Attempt to use matching table generates an erroneous many-to-many join for unknown reasons, so we will instead use "case_when"</span></span>
<span id="cb1-724"><a href="#cb1-724" aria-hidden="true" tabindex="-1"></a><span class="co"># result_detection_condition &lt;- read.csv("other/input/2023/misc/result_detection_condition.csv")</span></span>
<span id="cb1-725"><a href="#cb1-725" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb1-726"><a href="#cb1-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">result_detection_condition =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-727"><a href="#cb1-727" aria-hidden="true" tabindex="-1"></a>    result_qualifier <span class="sc">==</span> <span class="st">"U"</span> <span class="sc">~</span> <span class="st">"Not Detected"</span>,</span>
<span id="cb1-728"><a href="#cb1-728" aria-hidden="true" tabindex="-1"></a>    result_qualifier <span class="sc">==</span> <span class="st">"J"</span> <span class="sc">~</span> <span class="st">"Present Below Quantification Limit"</span>,</span>
<span id="cb1-729"><a href="#cb1-729" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span>))</span>
<span id="cb1-730"><a href="#cb1-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-731"><a href="#cb1-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-732"><a href="#cb1-732" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Status ID  (make as very last step?)</span></span>
<span id="cb1-733"><a href="#cb1-733" aria-hidden="true" tabindex="-1"></a><span class="co"># decision made after QA/QC process</span></span>
<span id="cb1-734"><a href="#cb1-734" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TBD</span><span class="co"> work to be completed here &lt;--------------------------------------------</span></span>
<span id="cb1-735"><a href="#cb1-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-736"><a href="#cb1-736" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: the acronyms &amp; terminology for detection limits provided by SGS differ slightly from those required by CDX</span></span>
<span id="cb1-737"><a href="#cb1-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-738"><a href="#cb1-738" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Type 1 </span></span>
<span id="cb1-739"><a href="#cb1-739" aria-hidden="true" tabindex="-1"></a><span class="co"># Lower Quantitation Limit (listed as "loq", or "Limit of Quantitation")</span></span>
<span id="cb1-740"><a href="#cb1-740" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_type_1 =</span> <span class="st">"Lower Quantitation Limit"</span>)</span>
<span id="cb1-741"><a href="#cb1-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-742"><a href="#cb1-742" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Value 1    </span></span>
<span id="cb1-743"><a href="#cb1-743" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_value_1 =</span> <span class="dv">1</span>)</span>
<span id="cb1-744"><a href="#cb1-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-745"><a href="#cb1-745" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Unit 1 </span></span>
<span id="cb1-746"><a href="#cb1-746" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_unit_1 =</span> result_unit)</span>
<span id="cb1-747"><a href="#cb1-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-748"><a href="#cb1-748" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Type 2 </span></span>
<span id="cb1-749"><a href="#cb1-749" aria-hidden="true" tabindex="-1"></a><span class="co"># Method Detection Level (listed as "lod", or "limit of detection")</span></span>
<span id="cb1-750"><a href="#cb1-750" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_type_2 =</span> <span class="st">""</span>)</span>
<span id="cb1-751"><a href="#cb1-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-752"><a href="#cb1-752" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Value 2    </span></span>
<span id="cb1-753"><a href="#cb1-753" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_value_2 =</span> <span class="st">""</span>)</span>
<span id="cb1-754"><a href="#cb1-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-755"><a href="#cb1-755" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Unit 2 </span></span>
<span id="cb1-756"><a href="#cb1-756" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_unit_2 =</span> result_unit)</span>
<span id="cb1-757"><a href="#cb1-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-758"><a href="#cb1-758" aria-hidden="true" tabindex="-1"></a><span class="co"># Laboratory Name   </span></span>
<span id="cb1-759"><a href="#cb1-759" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">laboratory_name  =</span> <span class="st">"Soldotna Wastewater Treatment Plant, Soldotna, Alaska"</span>)</span>
<span id="cb1-760"><a href="#cb1-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-761"><a href="#cb1-761" aria-hidden="true" tabindex="-1"></a><span class="co"># Laboratory Comment Text   </span></span>
<span id="cb1-762"><a href="#cb1-762" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TBD</span></span>
<span id="cb1-763"><a href="#cb1-763" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">lab_comment_text =</span> notes)</span>
<span id="cb1-764"><a href="#cb1-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-765"><a href="#cb1-765" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis Start Date   </span></span>
<span id="cb1-766"><a href="#cb1-766" aria-hidden="true" tabindex="-1"></a><span class="co"># all FC samples are analyzed the same day as received by the lab</span></span>
<span id="cb1-767"><a href="#cb1-767" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">analysis_start_date =</span> activity_start_date)</span>
<span id="cb1-768"><a href="#cb1-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-769"><a href="#cb1-769" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis Start Time   </span></span>
<span id="cb1-770"><a href="#cb1-770" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">analysis_start_time =</span> time_in)</span>
<span id="cb1-771"><a href="#cb1-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-772"><a href="#cb1-772" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis Start Time Zone (can vary by year if subcontract lab used)</span></span>
<span id="cb1-773"><a href="#cb1-773" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">analysis_start_time_zone =</span> <span class="st">"AKST"</span>)</span>
<span id="cb1-774"><a href="#cb1-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-775"><a href="#cb1-775" aria-hidden="true" tabindex="-1"></a><span class="co"># Thermal Preservative Used ***</span></span>
<span id="cb1-776"><a href="#cb1-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-777"><a href="#cb1-777" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample Container Type </span></span>
<span id="cb1-778"><a href="#cb1-778" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">sample_container_type =</span> <span class="st">"Plastic Bottle"</span>)</span>
<span id="cb1-779"><a href="#cb1-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-780"><a href="#cb1-780" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample Container Color    </span></span>
<span id="cb1-781"><a href="#cb1-781" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">sample_container_color =</span> <span class="st">"Clear"</span>)</span>
<span id="cb1-782"><a href="#cb1-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-783"><a href="#cb1-783" aria-hidden="true" tabindex="-1"></a><span class="co"># Chemical Preservative Used </span></span>
<span id="cb1-784"><a href="#cb1-784" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">chemical_preservative_used =</span> <span class="st">""</span>)</span>
<span id="cb1-785"><a href="#cb1-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-786"><a href="#cb1-786" aria-hidden="true" tabindex="-1"></a><span class="co"># date received at lab is same as activity date</span></span>
<span id="cb1-787"><a href="#cb1-787" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">rec_date =</span> activity_start_date)</span>
<span id="cb1-788"><a href="#cb1-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-789"><a href="#cb1-789" aria-hidden="true" tabindex="-1"></a><span class="co"># create Activity ID column</span></span>
<span id="cb1-790"><a href="#cb1-790" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-791"><a href="#cb1-791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_id =</span> <span class="fu">case_when</span>(    </span>
<span id="cb1-792"><a href="#cb1-792" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"POS|LB"</span>, activity_type_abbrv) <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb1-793"><a href="#cb1-793" aria-hidden="true" tabindex="-1"></a>    activity_type_abbrv <span class="sc">==</span> <span class="st">""</span> <span class="sc">~</span> <span class="fu">paste0</span>(site_id,<span class="st">"-"</span>,activity_start_date,<span class="st">"-"</span>,analyte_abbrv),</span>
<span id="cb1-794"><a href="#cb1-794" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">paste0</span>(site_id,<span class="st">"-"</span>,activity_start_date,<span class="st">"-"</span>,analyte_abbrv,<span class="st">"-"</span>,activity_type_abbrv))) </span>
<span id="cb1-795"><a href="#cb1-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-796"><a href="#cb1-796" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-797"><a href="#cb1-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-798"><a href="#cb1-798" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-799"><a href="#cb1-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-800"><a href="#cb1-800" aria-hidden="true" tabindex="-1"></a><span class="fu">##### 2023 Total Suspended Solids Lab Results (Soldotna Wastewater Treatment Plant (SWWTP))</span></span>
<span id="cb1-801"><a href="#cb1-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-802"><a href="#cb1-802" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = F}</span></span>
<span id="cb1-803"><a href="#cb1-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-804"><a href="#cb1-804" aria-hidden="true" tabindex="-1"></a><span class="do">############################ Part C: SWWTP Fecal Coliform Data #############################</span></span>
<span id="cb1-805"><a href="#cb1-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-806"><a href="#cb1-806" aria-hidden="true" tabindex="-1"></a><span class="co"># read in</span></span>
<span id="cb1-807"><a href="#cb1-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-808"><a href="#cb1-808" aria-hidden="true" tabindex="-1"></a><span class="co"># spring</span></span>
<span id="cb1-809"><a href="#cb1-809" aria-hidden="true" tabindex="-1"></a>spring_23_tss_dir <span class="ot">&lt;-</span> <span class="st">"other/input/2023/spring_2023_wqx_data/Data/SWWTP/KRWF TSS MONITORING 05-02-23.xlsx"</span></span>
<span id="cb1-810"><a href="#cb1-810" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">embed_file</span>(spring_23_tss_dir, <span class="at">text =</span> <span class="st">"Download Original Spring 2023 Total Suspended Solids Results from SWWTP"</span>)</span>
<span id="cb1-811"><a href="#cb1-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-812"><a href="#cb1-812" aria-hidden="true" tabindex="-1"></a><span class="co"># summer</span></span>
<span id="cb1-813"><a href="#cb1-813" aria-hidden="true" tabindex="-1"></a>summer_23_tss_dir <span class="ot">&lt;-</span> <span class="st">"other/input/2023/summer_2023_wqx_data/Data/SWWTP/KRWF TSS MONITORING 07-18-23.xlsx"</span></span>
<span id="cb1-814"><a href="#cb1-814" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">embed_file</span>(spring_23_tss_dir, <span class="at">text =</span> <span class="st">"Download Original Summer 2023 Total Suspended Solids Results from SWWTP"</span>)</span>
<span id="cb1-815"><a href="#cb1-815" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-816"><a href="#cb1-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-817"><a href="#cb1-817" aria-hidden="true" tabindex="-1"></a>Chain of custody documents available upon request</span>
<span id="cb1-818"><a href="#cb1-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-819"><a href="#cb1-819" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = F}</span></span>
<span id="cb1-820"><a href="#cb1-820" aria-hidden="true" tabindex="-1"></a><span class="co"># read in 2023 TSS data</span></span>
<span id="cb1-821"><a href="#cb1-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-822"><a href="#cb1-822" aria-hidden="true" tabindex="-1"></a><span class="co"># spring</span></span>
<span id="cb1-823"><a href="#cb1-823" aria-hidden="true" tabindex="-1"></a>spring_23_tss <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(spring_23_tss_dir, <span class="at">sheet =</span> <span class="st">"Updated_Formatting"</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">col_types =</span> <span class="st">"text"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-824"><a href="#cb1-824" aria-hidden="true" tabindex="-1"></a>  <span class="co"># see "ReadMe" document at other\input\2023\spring_2023_wqx_data\Chain of Custody Forms\completed forms for rec_time rationale</span></span>
<span id="cb1-825"><a href="#cb1-825" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rec_time =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-826"><a href="#cb1-826" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"RM_1.5"</span>,Sample_Location) <span class="sc">~</span> <span class="fu">as_hms</span>(<span class="st">"15:30:00"</span>),</span>
<span id="cb1-827"><a href="#cb1-827" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as_hms</span>(<span class="st">"12:44:00"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1-828"><a href="#cb1-828" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rec_date =</span> spring23_sample_date)</span>
<span id="cb1-829"><a href="#cb1-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-830"><a href="#cb1-830" aria-hidden="true" tabindex="-1"></a><span class="co"># summer</span></span>
<span id="cb1-831"><a href="#cb1-831" aria-hidden="true" tabindex="-1"></a>summer_23_tss <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(summer_23_tss_dir, <span class="at">sheet =</span> <span class="st">"Updated_Formatting"</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">col_types =</span> <span class="st">"text"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-832"><a href="#cb1-832" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rec_time =</span> <span class="fu">as_hms</span>(<span class="st">"12:25:00"</span>),</span>
<span id="cb1-833"><a href="#cb1-833" aria-hidden="true" tabindex="-1"></a>         <span class="at">rec_date =</span> summer23_sample_date,)</span>
<span id="cb1-834"><a href="#cb1-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-835"><a href="#cb1-835" aria-hidden="true" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb1-836"><a href="#cb1-836" aria-hidden="true" tabindex="-1"></a>tss23 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(spring_23_tss,summer_23_tss) <span class="sc">%&gt;%</span></span>
<span id="cb1-837"><a href="#cb1-837" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-838"><a href="#cb1-838" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clean up names and formats</span></span>
<span id="cb1-839"><a href="#cb1-839" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-840"><a href="#cb1-840" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">field_sample_date =</span> <span class="fu">excel_numeric_to_date</span>(<span class="fu">as.numeric</span>(field_sample_date)),</span>
<span id="cb1-841"><a href="#cb1-841" aria-hidden="true" tabindex="-1"></a>            <span class="at">date_of_analysis =</span> <span class="fu">excel_numeric_to_date</span>((<span class="fu">as.numeric</span>(date_of_analysis)))) <span class="sc">%&gt;%</span></span>
<span id="cb1-842"><a href="#cb1-842" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_sampled =</span> <span class="fu">format</span>(<span class="fu">as.POSIXct</span>(<span class="fu">Sys.Date</span>() <span class="sc">+</span> <span class="fu">as.numeric</span>(sample_time)), <span class="st">"%H:%M"</span>, <span class="at">tz=</span><span class="st">"UTC"</span>),</span>
<span id="cb1-843"><a href="#cb1-843" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_analysis =</span> <span class="fu">format</span>(<span class="fu">as.POSIXct</span>(<span class="fu">Sys.Date</span>() <span class="sc">+</span> <span class="fu">as.numeric</span>(time)), <span class="st">"%H:%M"</span>, <span class="at">tz=</span><span class="st">"UTC"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-844"><a href="#cb1-844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>sample_time,<span class="sc">-</span>time,<span class="sc">-</span>qc1,<span class="sc">-</span>data_entry,<span class="sc">-</span>qc2)</span>
<span id="cb1-845"><a href="#cb1-845" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-846"><a href="#cb1-846" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-847"><a href="#cb1-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-848"><a href="#cb1-848" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-849"><a href="#cb1-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-850"><a href="#cb1-850" aria-hidden="true" tabindex="-1"></a><span class="do">################### Part C.2: Create Consistent Sample Location Names for SWWTP TSS data #####################</span></span>
<span id="cb1-851"><a href="#cb1-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-852"><a href="#cb1-852" aria-hidden="true" tabindex="-1"></a><span class="co"># execute once and manually modify csv to create match table</span></span>
<span id="cb1-853"><a href="#cb1-853" aria-hidden="true" tabindex="-1"></a><span class="co">#z &lt;- tss23 %&gt;%</span></span>
<span id="cb1-854"><a href="#cb1-854" aria-hidden="true" tabindex="-1"></a><span class="co">#  select(sample_location) %&gt;%</span></span>
<span id="cb1-855"><a href="#cb1-855" aria-hidden="true" tabindex="-1"></a><span class="co">#  distinct()</span></span>
<span id="cb1-856"><a href="#cb1-856" aria-hidden="true" tabindex="-1"></a><span class="co">#write.csv(z,"other/input/2023/misc/site_names_manual_edit_tss23.csv", row.names = F)</span></span>
<span id="cb1-857"><a href="#cb1-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-858"><a href="#cb1-858" aria-hidden="true" tabindex="-1"></a><span class="co"># read in tss sites</span></span>
<span id="cb1-859"><a href="#cb1-859" aria-hidden="true" tabindex="-1"></a>tss23_site_names <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"other/input/2023/misc/site_names_manual_edit_tss23.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-860"><a href="#cb1-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>()</span>
<span id="cb1-861"><a href="#cb1-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-862"><a href="#cb1-862" aria-hidden="true" tabindex="-1"></a><span class="co"># join site names to tss data frame</span></span>
<span id="cb1-863"><a href="#cb1-863" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">left_join</span>(tss23_site_names)</span>
<span id="cb1-864"><a href="#cb1-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-865"><a href="#cb1-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-866"><a href="#cb1-866" aria-hidden="true" tabindex="-1"></a><span class="do">############### Part C.3: Assign miscellaneous calculated columns for 2023 SWWTP TSS (needed for next steps) ###############</span></span>
<span id="cb1-867"><a href="#cb1-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-868"><a href="#cb1-868" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Type </span></span>
<span id="cb1-869"><a href="#cb1-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-870"><a href="#cb1-870" aria-hidden="true" tabindex="-1"></a><span class="co"># method blank, field duplicate)</span></span>
<span id="cb1-871"><a href="#cb1-871" aria-hidden="true" tabindex="-1"></a><span class="co"># this column is addressed out of left to right sequence because its content is needed to generate Activity ID</span></span>
<span id="cb1-872"><a href="#cb1-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-873"><a href="#cb1-873" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-874"><a href="#cb1-874" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-875"><a href="#cb1-875" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"DUP"</span>, sample_location) <span class="sc">~</span> <span class="st">"Quality Control Field Replicate Msr/Obs"</span>,</span>
<span id="cb1-876"><a href="#cb1-876" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"BLANK"</span>, sample_location) <span class="sc">~</span> <span class="st">"Quality Control Sample-Lab Blank"</span>,</span>
<span id="cb1-877"><a href="#cb1-877" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Field Msr/Obs"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-878"><a href="#cb1-878" aria-hidden="true" tabindex="-1"></a><span class="co"># designate activity type abbreviations for late use in actvity ID</span></span>
<span id="cb1-879"><a href="#cb1-879" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_type_abbrv =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-880"><a href="#cb1-880" aria-hidden="true" tabindex="-1"></a>    activity_type <span class="sc">==</span> <span class="st">"Quality Control Field Replicate Msr/Obs"</span> <span class="sc">~</span> <span class="st">"DUP"</span>,</span>
<span id="cb1-881"><a href="#cb1-881" aria-hidden="true" tabindex="-1"></a>    activity_type <span class="sc">==</span> <span class="st">"Quality Control Sample-Lab Blank"</span> <span class="sc">~</span> <span class="st">"LB"</span>,</span>
<span id="cb1-882"><a href="#cb1-882" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span>))</span>
<span id="cb1-883"><a href="#cb1-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-884"><a href="#cb1-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-885"><a href="#cb1-885" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Sample Fraction    </span></span>
<span id="cb1-886"><a href="#cb1-886" aria-hidden="true" tabindex="-1"></a><span class="co"># CDX domains: none used in 2021 example</span></span>
<span id="cb1-887"><a href="#cb1-887" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-888"><a href="#cb1-888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">result_sample_fraction =</span> <span class="st">""</span>)</span>
<span id="cb1-889"><a href="#cb1-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-890"><a href="#cb1-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-891"><a href="#cb1-891" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect Date</span></span>
<span id="cb1-892"><a href="#cb1-892" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">collect_date =</span> field_sample_date)</span>
<span id="cb1-893"><a href="#cb1-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-894"><a href="#cb1-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-895"><a href="#cb1-895" aria-hidden="true" tabindex="-1"></a><span class="do">################### Part C.4: Proceed left to right across column names to calculate as needed #####################</span></span>
<span id="cb1-896"><a href="#cb1-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-897"><a href="#cb1-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-898"><a href="#cb1-898" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: column names marked with triple asterisk "***" are common to all dataframes, and thus are done in bulk at the end of steps that are not common to all dataframes</span></span>
<span id="cb1-899"><a href="#cb1-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-900"><a href="#cb1-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-901"><a href="#cb1-901" aria-hidden="true" tabindex="-1"></a><span class="co"># Project ID (static)***</span></span>
<span id="cb1-902"><a href="#cb1-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-903"><a href="#cb1-903" aria-hidden="true" tabindex="-1"></a><span class="co"># Monitoring Location ID (static, already present)</span></span>
<span id="cb1-904"><a href="#cb1-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-905"><a href="#cb1-905" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Media Name   (static)***</span></span>
<span id="cb1-906"><a href="#cb1-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-907"><a href="#cb1-907" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Media Subdivision Name   (static)***</span></span>
<span id="cb1-908"><a href="#cb1-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-909"><a href="#cb1-909" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity ID   (concatenated) (unique identifier) (limit of X  characters)</span></span>
<span id="cb1-910"><a href="#cb1-910" aria-hidden="true" tabindex="-1"></a><span class="co"># due to CDX character limitations, we need to use abbreviations for 1) characteristic (analyte) and 2) sample type</span></span>
<span id="cb1-911"><a href="#cb1-911" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">analyte_abbrv =</span> <span class="st">"TSS"</span>)</span>
<span id="cb1-912"><a href="#cb1-912" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-913"><a href="#cb1-913" aria-hidden="true" tabindex="-1"></a><span class="co"># create Activity ID column</span></span>
<span id="cb1-914"><a href="#cb1-914" aria-hidden="true" tabindex="-1"></a><span class="co"># note: this step will be performed last in the tss block, because corrections to date and/or date format may be made throughout subsequent steps here</span></span>
<span id="cb1-915"><a href="#cb1-915" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-916"><a href="#cb1-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-917"><a href="#cb1-917" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Start Date   </span></span>
<span id="cb1-918"><a href="#cb1-918" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">activity_start_date =</span> collect_date)</span>
<span id="cb1-919"><a href="#cb1-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-920"><a href="#cb1-920" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Start Time   (static, specific to SGS)</span></span>
<span id="cb1-921"><a href="#cb1-921" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">activity_start_time =</span> time_sampled)</span>
<span id="cb1-922"><a href="#cb1-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-923"><a href="#cb1-923" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Start Time Zone***</span></span>
<span id="cb1-924"><a href="#cb1-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-925"><a href="#cb1-925" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Depth/Height Measure ***</span></span>
<span id="cb1-926"><a href="#cb1-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-927"><a href="#cb1-927" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Depth/Height Unit    ***</span></span>
<span id="cb1-928"><a href="#cb1-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-929"><a href="#cb1-929" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Comment ***</span></span>
<span id="cb1-930"><a href="#cb1-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-931"><a href="#cb1-931" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Horizontal Collection Method ***</span></span>
<span id="cb1-932"><a href="#cb1-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-933"><a href="#cb1-933" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Horizontal Reference Datum   ***</span></span>
<span id="cb1-934"><a href="#cb1-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-935"><a href="#cb1-935" aria-hidden="true" tabindex="-1"></a><span class="co"># Characteristic Name   </span></span>
<span id="cb1-936"><a href="#cb1-936" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">characteristic_name =</span> <span class="st">"Total suspended solids"</span>)</span>
<span id="cb1-937"><a href="#cb1-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-938"><a href="#cb1-938" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Analytical Method ID,  and</span></span>
<span id="cb1-939"><a href="#cb1-939" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Analytical Method Context  </span></span>
<span id="cb1-940"><a href="#cb1-940" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-941"><a href="#cb1-941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">result_analytical_method_id =</span> <span class="st">"2540-D"</span>,</span>
<span id="cb1-942"><a href="#cb1-942" aria-hidden="true" tabindex="-1"></a>         <span class="at">result_analytical_method_context =</span> <span class="st">"APHA"</span>)</span>
<span id="cb1-943"><a href="#cb1-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-944"><a href="#cb1-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-945"><a href="#cb1-945" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Value  </span></span>
<span id="cb1-946"><a href="#cb1-946" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">result_value =</span> s_s_mg_l)</span>
<span id="cb1-947"><a href="#cb1-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-948"><a href="#cb1-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-949"><a href="#cb1-949" aria-hidden="true" tabindex="-1"></a> <span class="co"># Result Unit  </span></span>
<span id="cb1-950"><a href="#cb1-950" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_unit =</span> <span class="st">"mg/L"</span>)</span>
<span id="cb1-951"><a href="#cb1-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-952"><a href="#cb1-952" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Qualifier</span></span>
<span id="cb1-953"><a href="#cb1-953" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-954"><a href="#cb1-954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">result_qualifier =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-955"><a href="#cb1-955" aria-hidden="true" tabindex="-1"></a>    result_value <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> result_value <span class="sc">&gt;</span> <span class="fl">0.31</span> <span class="sc">~</span> <span class="st">"J"</span>,</span>
<span id="cb1-956"><a href="#cb1-956" aria-hidden="true" tabindex="-1"></a>    result_value <span class="sc">&lt;</span> <span class="fl">0.31</span> <span class="sc">~</span> <span class="st">"U"</span>))</span>
<span id="cb1-957"><a href="#cb1-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-958"><a href="#cb1-958" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Weight Basis   ***</span></span>
<span id="cb1-959"><a href="#cb1-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-960"><a href="#cb1-960" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Sample Fraction    </span></span>
<span id="cb1-961"><a href="#cb1-961" aria-hidden="true" tabindex="-1"></a><span class="do">## already completed in a previous step</span></span>
<span id="cb1-962"><a href="#cb1-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-963"><a href="#cb1-963" aria-hidden="true" tabindex="-1"></a><span class="co"># Method Speciation </span></span>
<span id="cb1-964"><a href="#cb1-964" aria-hidden="true" tabindex="-1"></a><span class="co"># not applicable to TSS</span></span>
<span id="cb1-965"><a href="#cb1-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-966"><a href="#cb1-966" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Value Type ***</span></span>
<span id="cb1-967"><a href="#cb1-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-968"><a href="#cb1-968" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample Collection Equipment Name ***  </span></span>
<span id="cb1-969"><a href="#cb1-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-970"><a href="#cb1-970" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Condition    </span></span>
<span id="cb1-971"><a href="#cb1-971" aria-hidden="true" tabindex="-1"></a><span class="co"># categorical choice based on result qualifier. </span></span>
<span id="cb1-972"><a href="#cb1-972" aria-hidden="true" tabindex="-1"></a><span class="co"># Attempt to use matching table generates an erroneous many-to-many join for unknown reasons, so we will instead use "case_when"</span></span>
<span id="cb1-973"><a href="#cb1-973" aria-hidden="true" tabindex="-1"></a><span class="co"># result_detection_condition &lt;- read.csv("other/input/2023/misc/result_detection_condition.csv")</span></span>
<span id="cb1-974"><a href="#cb1-974" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb1-975"><a href="#cb1-975" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">result_detection_condition =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-976"><a href="#cb1-976" aria-hidden="true" tabindex="-1"></a>    result_qualifier <span class="sc">==</span> <span class="st">"U"</span> <span class="sc">~</span> <span class="st">"Not Detected"</span>,</span>
<span id="cb1-977"><a href="#cb1-977" aria-hidden="true" tabindex="-1"></a>    result_qualifier <span class="sc">==</span> <span class="st">"J"</span> <span class="sc">~</span> <span class="st">"Present Below Quantification Limit"</span>,</span>
<span id="cb1-978"><a href="#cb1-978" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span>))</span>
<span id="cb1-979"><a href="#cb1-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-980"><a href="#cb1-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-981"><a href="#cb1-981" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Status ID  (make as very last step?)</span></span>
<span id="cb1-982"><a href="#cb1-982" aria-hidden="true" tabindex="-1"></a><span class="co"># decision made after QA/QC process</span></span>
<span id="cb1-983"><a href="#cb1-983" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TBD</span><span class="co"> work to be completed here &lt;--------------------------------------------</span></span>
<span id="cb1-984"><a href="#cb1-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-985"><a href="#cb1-985" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: the acronyms &amp; terminology for detection limits provided by SGS differ slightly from those required by CDX</span></span>
<span id="cb1-986"><a href="#cb1-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-987"><a href="#cb1-987" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Type 1 </span></span>
<span id="cb1-988"><a href="#cb1-988" aria-hidden="true" tabindex="-1"></a><span class="co"># Lower Quantitation Limit (listed as "loq", or "Limit of Quantitation")</span></span>
<span id="cb1-989"><a href="#cb1-989" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_type_1 =</span> <span class="st">"Lower Quantitation Limit"</span>)</span>
<span id="cb1-990"><a href="#cb1-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-991"><a href="#cb1-991" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Value 1    </span></span>
<span id="cb1-992"><a href="#cb1-992" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_value_1 =</span> <span class="dv">1</span>)</span>
<span id="cb1-993"><a href="#cb1-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-994"><a href="#cb1-994" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Unit 1 </span></span>
<span id="cb1-995"><a href="#cb1-995" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_unit_1 =</span> result_unit)</span>
<span id="cb1-996"><a href="#cb1-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-997"><a href="#cb1-997" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Type 2 </span></span>
<span id="cb1-998"><a href="#cb1-998" aria-hidden="true" tabindex="-1"></a><span class="co"># Method Detection Level (listed as "lod", or "limit of detection")</span></span>
<span id="cb1-999"><a href="#cb1-999" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_type_2 =</span> <span class="st">"Method Detection Level"</span>)</span>
<span id="cb1-1000"><a href="#cb1-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1001"><a href="#cb1-1001" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Value 2    </span></span>
<span id="cb1-1002"><a href="#cb1-1002" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_value_2 =</span> <span class="fl">0.31</span>)</span>
<span id="cb1-1003"><a href="#cb1-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1004"><a href="#cb1-1004" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Detection Limit Unit 2 </span></span>
<span id="cb1-1005"><a href="#cb1-1005" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_detection_limit_unit_2 =</span> result_unit)</span>
<span id="cb1-1006"><a href="#cb1-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1007"><a href="#cb1-1007" aria-hidden="true" tabindex="-1"></a><span class="co"># Laboratory Name   </span></span>
<span id="cb1-1008"><a href="#cb1-1008" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">laboratory_name  =</span> <span class="st">"Soldotna Wastewater Treatment Plant, Soldotna, Alaska"</span>)</span>
<span id="cb1-1009"><a href="#cb1-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1010"><a href="#cb1-1010" aria-hidden="true" tabindex="-1"></a><span class="co"># Laboratory Comment Text   </span></span>
<span id="cb1-1011"><a href="#cb1-1011" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TBD</span></span>
<span id="cb1-1012"><a href="#cb1-1012" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">lab_comment_text =</span> notes)</span>
<span id="cb1-1013"><a href="#cb1-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1014"><a href="#cb1-1014" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis Start Date   </span></span>
<span id="cb1-1015"><a href="#cb1-1015" aria-hidden="true" tabindex="-1"></a><span class="co"># all FC samples are analyzed the same day as received by the lab</span></span>
<span id="cb1-1016"><a href="#cb1-1016" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">analysis_start_date =</span> date_of_analysis)</span>
<span id="cb1-1017"><a href="#cb1-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1018"><a href="#cb1-1018" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis Start Time   </span></span>
<span id="cb1-1019"><a href="#cb1-1019" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">analysis_start_time =</span> time_analysis)</span>
<span id="cb1-1020"><a href="#cb1-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1021"><a href="#cb1-1021" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis Start Time Zone (can vary by year if subcontract lab used)</span></span>
<span id="cb1-1022"><a href="#cb1-1022" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">analysis_start_time_zone =</span> <span class="st">"AKST"</span>)</span>
<span id="cb1-1023"><a href="#cb1-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1024"><a href="#cb1-1024" aria-hidden="true" tabindex="-1"></a><span class="co"># Thermal Preservative Used ***</span></span>
<span id="cb1-1025"><a href="#cb1-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1026"><a href="#cb1-1026" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample Container Type </span></span>
<span id="cb1-1027"><a href="#cb1-1027" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">sample_container_type =</span> <span class="st">"Plastic Bottle"</span>)</span>
<span id="cb1-1028"><a href="#cb1-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1029"><a href="#cb1-1029" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample Container Color    </span></span>
<span id="cb1-1030"><a href="#cb1-1030" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">sample_container_color =</span> <span class="st">"Opaque"</span>)</span>
<span id="cb1-1031"><a href="#cb1-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1032"><a href="#cb1-1032" aria-hidden="true" tabindex="-1"></a><span class="co"># Chemical Preservative Used </span></span>
<span id="cb1-1033"><a href="#cb1-1033" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">chemical_preservative_used =</span> <span class="st">""</span>)</span>
<span id="cb1-1034"><a href="#cb1-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1035"><a href="#cb1-1035" aria-hidden="true" tabindex="-1"></a><span class="co"># create Activity ID column</span></span>
<span id="cb1-1036"><a href="#cb1-1036" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-1037"><a href="#cb1-1037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_id =</span> <span class="fu">case_when</span>(    </span>
<span id="cb1-1038"><a href="#cb1-1038" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"DUP"</span>, activity_type_abbrv) <span class="sc">~</span> <span class="fu">paste0</span>(site_id,<span class="st">"-"</span>,activity_start_date,<span class="st">"-"</span>,analyte_abbrv,<span class="st">"-"</span>,activity_type_abbrv),</span>
<span id="cb1-1039"><a href="#cb1-1039" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"LB"</span>, activity_type_abbrv) <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb1-1040"><a href="#cb1-1040" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span>  <span class="fu">paste0</span>(site_id,<span class="st">"-"</span>,activity_start_date,<span class="st">"-"</span>,analyte_abbrv))) </span>
<span id="cb1-1041"><a href="#cb1-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1042"><a href="#cb1-1042" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1043"><a href="#cb1-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1044"><a href="#cb1-1044" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo =F}</span></span>
<span id="cb1-1045"><a href="#cb1-1045" aria-hidden="true" tabindex="-1"></a><span class="co"># remove extraneous dataframes</span></span>
<span id="cb1-1046"><a href="#cb1-1046" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(fc23_site_names,sgs_sitenames,spring_23_fc,spring_23_tss,summer_23_fc,summer_23_tss,tss23_site_names)</span>
<span id="cb1-1047"><a href="#cb1-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1048"><a href="#cb1-1048" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1049"><a href="#cb1-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1050"><a href="#cb1-1050" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1051"><a href="#cb1-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1052"><a href="#cb1-1052" aria-hidden="true" tabindex="-1"></a><span class="do">################# Part D: Join Separate Datasets into shared dataframe (SGS, Fecal Coliform, TSS) ###################</span></span>
<span id="cb1-1053"><a href="#cb1-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1054"><a href="#cb1-1054" aria-hidden="true" tabindex="-1"></a><span class="co"># strategy - 1) retain only needed columns (2021 example), then 2) assign consistent column classes (temp loggers example)</span></span>
<span id="cb1-1055"><a href="#cb1-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1056"><a href="#cb1-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1057"><a href="#cb1-1057" aria-hidden="true" tabindex="-1"></a><span class="co"># subset dataframes to limited set of desired final colnames based on 2021 example</span></span>
<span id="cb1-1058"><a href="#cb1-1058" aria-hidden="true" tabindex="-1"></a><span class="co"># read in column names</span></span>
<span id="cb1-1059"><a href="#cb1-1059" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"other/output/example_output/results_activities_2021.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-1060"><a href="#cb1-1060" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() </span>
<span id="cb1-1061"><a href="#cb1-1061" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-1062"><a href="#cb1-1062" aria-hidden="true" tabindex="-1"></a><span class="co"># For QA/QC purposes only, we also want to various columns:</span></span>
<span id="cb1-1063"><a href="#cb1-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1064"><a href="#cb1-1064" aria-hidden="true" tabindex="-1"></a><span class="co"># a.) retain the "sample type" column; which contains information about the purpose of various lab analyses (e.g. method blanks, matrix spikes, etc). This column is included in the SGS data deliverable, and is manually added to the other spreadsheets from the wastewater treatment plant</span></span>
<span id="cb1-1065"><a href="#cb1-1065" aria-hidden="true" tabindex="-1"></a>col_names <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">sample_type =</span> <span class="st">""</span>)</span>
<span id="cb1-1066"><a href="#cb1-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1067"><a href="#cb1-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1068"><a href="#cb1-1068" aria-hidden="true" tabindex="-1"></a><span class="co"># b.) retain info about when samples were received to laboratories (for hold time calculations)</span></span>
<span id="cb1-1069"><a href="#cb1-1069" aria-hidden="true" tabindex="-1"></a>col_names <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">rec_time =</span> <span class="st">""</span>,</span>
<span id="cb1-1070"><a href="#cb1-1070" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rec_date =</span> <span class="st">""</span>)</span>
<span id="cb1-1071"><a href="#cb1-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1072"><a href="#cb1-1072" aria-hidden="true" tabindex="-1"></a><span class="co"># convert column names to list</span></span>
<span id="cb1-1073"><a href="#cb1-1073" aria-hidden="true" tabindex="-1"></a>col_names <span class="sc">%&lt;&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb1-1074"><a href="#cb1-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1075"><a href="#cb1-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1076"><a href="#cb1-1076" aria-hidden="true" tabindex="-1"></a><span class="co"># retain desired columns from each dataframe </span></span>
<span id="cb1-1077"><a href="#cb1-1077" aria-hidden="true" tabindex="-1"></a><span class="co"># and, convert all columns to character</span></span>
<span id="cb1-1078"><a href="#cb1-1078" aria-hidden="true" tabindex="-1"></a>sgs23 <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb1-1079"><a href="#cb1-1079" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">one_of</span>(col_names)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-1080"><a href="#cb1-1080" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.character))</span>
<span id="cb1-1081"><a href="#cb1-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1082"><a href="#cb1-1082" aria-hidden="true" tabindex="-1"></a>fc23 <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb1-1083"><a href="#cb1-1083" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">one_of</span>(col_names)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1084"><a href="#cb1-1084" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.character))</span>
<span id="cb1-1085"><a href="#cb1-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1086"><a href="#cb1-1086" aria-hidden="true" tabindex="-1"></a>tss23 <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb1-1087"><a href="#cb1-1087" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">one_of</span>(col_names)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1088"><a href="#cb1-1088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.character))</span>
<span id="cb1-1089"><a href="#cb1-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1090"><a href="#cb1-1090" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb1-1091"><a href="#cb1-1091" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(sgs23,fc23,tss23)</span>
<span id="cb1-1092"><a href="#cb1-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1093"><a href="#cb1-1093" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1094"><a href="#cb1-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1095"><a href="#cb1-1095" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1096"><a href="#cb1-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1097"><a href="#cb1-1097" aria-hidden="true" tabindex="-1"></a><span class="do">##################### Part E: Assign Information Common to All 2023 Datasets #########################</span></span>
<span id="cb1-1098"><a href="#cb1-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1099"><a href="#cb1-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1100"><a href="#cb1-1100" aria-hidden="true" tabindex="-1"></a><span class="co"># Static additions to overall combined dataset (marked as *** in above steps)</span></span>
<span id="cb1-1101"><a href="#cb1-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1102"><a href="#cb1-1102" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: will need to replace all "sgs23" with "dat"</span></span>
<span id="cb1-1103"><a href="#cb1-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1104"><a href="#cb1-1104" aria-hidden="true" tabindex="-1"></a><span class="co"># Project ID (static)***</span></span>
<span id="cb1-1105"><a href="#cb1-1105" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">project_id =</span> <span class="st">"10000007"</span>)</span>
<span id="cb1-1106"><a href="#cb1-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1107"><a href="#cb1-1107" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Media Name   (static)***</span></span>
<span id="cb1-1108"><a href="#cb1-1108" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">activity_media_name =</span> <span class="st">"Water"</span>)</span>
<span id="cb1-1109"><a href="#cb1-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1110"><a href="#cb1-1110" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Media Subdivision Name   (static)***</span></span>
<span id="cb1-1111"><a href="#cb1-1111" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">activity_media_subdivision_name =</span> <span class="st">"Surface Water"</span>)</span>
<span id="cb1-1112"><a href="#cb1-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1113"><a href="#cb1-1113" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Start Time Zone***</span></span>
<span id="cb1-1114"><a href="#cb1-1114" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span> (<span class="at">activity_start_time_zone =</span> <span class="st">"AKST"</span>)</span>
<span id="cb1-1115"><a href="#cb1-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1116"><a href="#cb1-1116" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Latitude ***</span></span>
<span id="cb1-1117"><a href="#cb1-1117" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Longitude    ***</span></span>
<span id="cb1-1118"><a href="#cb1-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1119"><a href="#cb1-1119" aria-hidden="true" tabindex="-1"></a><span class="co"># read in unqiue lat/long by monitoring location id</span></span>
<span id="cb1-1120"><a href="#cb1-1120" aria-hidden="true" tabindex="-1"></a>lat_long <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"other/input/2023/misc/lat_long.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-1121"><a href="#cb1-1121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">monitoring_location_id =</span> <span class="fu">as.character</span>(monitoring_location_id))</span>
<span id="cb1-1122"><a href="#cb1-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1123"><a href="#cb1-1123" aria-hidden="true" tabindex="-1"></a><span class="co"># prep overall dataframe for join, then join</span></span>
<span id="cb1-1124"><a href="#cb1-1124" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb1-1125"><a href="#cb1-1125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">monitoring_location_id =</span> <span class="fu">str_trim</span>(monitoring_location_id)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1126"><a href="#cb1-1126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lat_long)</span>
<span id="cb1-1127"><a href="#cb1-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1128"><a href="#cb1-1128" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Depth/Height Measure ***</span></span>
<span id="cb1-1129"><a href="#cb1-1129" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">activity_depth_height_measure =</span> <span class="st">"15"</span>)</span>
<span id="cb1-1130"><a href="#cb1-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1131"><a href="#cb1-1131" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Depth/Height Unit    ***</span></span>
<span id="cb1-1132"><a href="#cb1-1132" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">activity_depth_height_unit =</span> <span class="st">"cm"</span>)</span>
<span id="cb1-1133"><a href="#cb1-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1134"><a href="#cb1-1134" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Comment ***</span></span>
<span id="cb1-1135"><a href="#cb1-1135" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">activity_comment =</span> <span class="st">""</span>)</span>
<span id="cb1-1136"><a href="#cb1-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1137"><a href="#cb1-1137" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Horizontal Collection Method ***</span></span>
<span id="cb1-1138"><a href="#cb1-1138" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">activity_horizontal_collection_method =</span> <span class="st">"GPS-Unspecified"</span>)</span>
<span id="cb1-1139"><a href="#cb1-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1140"><a href="#cb1-1140" aria-hidden="true" tabindex="-1"></a><span class="co"># Activity Horizontal Reference Datum   ***</span></span>
<span id="cb1-1141"><a href="#cb1-1141" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">activity_horizontal_reference_datum =</span> <span class="st">"NAD83"</span>)</span>
<span id="cb1-1142"><a href="#cb1-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1143"><a href="#cb1-1143" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Weight Basis   ***</span></span>
<span id="cb1-1144"><a href="#cb1-1144" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_weight_basis =</span> <span class="st">"Sampled"</span>)</span>
<span id="cb1-1145"><a href="#cb1-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1146"><a href="#cb1-1146" aria-hidden="true" tabindex="-1"></a><span class="co"># Result Value Type ***</span></span>
<span id="cb1-1147"><a href="#cb1-1147" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">result_value_type =</span> <span class="st">"Actual"</span>)</span>
<span id="cb1-1148"><a href="#cb1-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1149"><a href="#cb1-1149" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample Collection Equipment Name ***  </span></span>
<span id="cb1-1150"><a href="#cb1-1150" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">sample_collection_equipment_name =</span> <span class="st">"Water Bottle"</span>)</span>
<span id="cb1-1151"><a href="#cb1-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1152"><a href="#cb1-1152" aria-hidden="true" tabindex="-1"></a><span class="co"># Thermal Preservative Used ***</span></span>
<span id="cb1-1153"><a href="#cb1-1153" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">thermal_preservative_used =</span> <span class="st">"Cold Packs (4 deg C)"</span>)</span>
<span id="cb1-1154"><a href="#cb1-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1155"><a href="#cb1-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1156"><a href="#cb1-1156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1157"><a href="#cb1-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1158"><a href="#cb1-1158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1159"><a href="#cb1-1159" aria-hidden="true" tabindex="-1"></a><span class="co"># Miscellaneous Tasks; Address self-evident critical errors</span></span>
<span id="cb1-1160"><a href="#cb1-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1161"><a href="#cb1-1161" aria-hidden="true" tabindex="-1"></a><span class="do">### SGS Typos </span><span class="al">###</span></span>
<span id="cb1-1162"><a href="#cb1-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1163"><a href="#cb1-1163" aria-hidden="true" tabindex="-1"></a><span class="co"># A typo from the SGS labs resulted in showing multiple incorrect fieldwork dates for spring 2023. Correct this here</span></span>
<span id="cb1-1164"><a href="#cb1-1164" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-1165"><a href="#cb1-1165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-1166"><a href="#cb1-1166" aria-hidden="true" tabindex="-1"></a>  <span class="co"># here we will correct a typo showing lab QA/QC analyses occurring prior to summer field sampling date on 2023-07-18. By definition no activity could have occurred with these project samples beforehand, as they had not yet been collected</span></span>
<span id="cb1-1167"><a href="#cb1-1167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_start_date =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-1168"><a href="#cb1-1168" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ymd</span>(activity_start_date) <span class="sc">&lt;</span> <span class="fu">ymd</span>(<span class="st">"2023-07-18"</span>) <span class="sc">&amp;</span>  <span class="fu">ymd</span>(activity_start_date) <span class="sc">&gt;</span> <span class="fu">ymd</span>(<span class="st">"2023-07-13"</span>)</span>
<span id="cb1-1169"><a href="#cb1-1169" aria-hidden="true" tabindex="-1"></a>      <span class="sc">&amp;</span> sample_type <span class="sc">==</span> <span class="st">"PS"</span> <span class="sc">~</span> <span class="st">"2023-07-18"</span>,</span>
<span id="cb1-1170"><a href="#cb1-1170" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> activity_start_date)) </span>
<span id="cb1-1171"><a href="#cb1-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1172"><a href="#cb1-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1173"><a href="#cb1-1173" aria-hidden="true" tabindex="-1"></a><span class="co"># There are three rows that indicate sample information where no sample was actually collected. These are the fecal coliform and TSS samples from RM 10.1 on 5/2/2023 (site was not visited), and a fecal coliform sample from RM40 on 5/2/2023 that was spilled on site. Remove these extraneous rows.</span></span>
<span id="cb1-1174"><a href="#cb1-1174" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb1-1175"><a href="#cb1-1175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(result_value <span class="sc">!=</span> <span class="st">"N/A"</span>,</span>
<span id="cb1-1176"><a href="#cb1-1176" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(result_value))</span>
<span id="cb1-1177"><a href="#cb1-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1178"><a href="#cb1-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1179"><a href="#cb1-1179" aria-hidden="true" tabindex="-1"></a><span class="do">### Make Unit Names Consistent </span><span class="al">###</span></span>
<span id="cb1-1180"><a href="#cb1-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1181"><a href="#cb1-1181" aria-hidden="true" tabindex="-1"></a><span class="co"># Are all unit names consistent within each parameter? If not, make correction(s) here</span></span>
<span id="cb1-1182"><a href="#cb1-1182" aria-hidden="true" tabindex="-1"></a><span class="co">#z &lt;- dat %&gt;%</span></span>
<span id="cb1-1183"><a href="#cb1-1183" aria-hidden="true" tabindex="-1"></a><span class="co">#  distinct(characteristic_name,result_unit) %&gt;%</span></span>
<span id="cb1-1184"><a href="#cb1-1184" aria-hidden="true" tabindex="-1"></a><span class="co">#  arrange(characteristic_name)</span></span>
<span id="cb1-1185"><a href="#cb1-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1186"><a href="#cb1-1186" aria-hidden="true" tabindex="-1"></a><span class="co"># for 2023, we need to consolidate "ug/l" and "ug/L" throughout the dataframe (results and detection limits)</span></span>
<span id="cb1-1187"><a href="#cb1-1187" aria-hidden="true" tabindex="-1"></a>dat[dat <span class="sc">==</span> <span class="st">"ug/L"</span>] <span class="ot">&lt;-</span> <span class="st">'ug/l'</span></span>
<span id="cb1-1188"><a href="#cb1-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1189"><a href="#cb1-1189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1190"><a href="#cb1-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1191"><a href="#cb1-1191" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1192"><a href="#cb1-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1193"><a href="#cb1-1193" aria-hidden="true" tabindex="-1"></a><span class="co"># transform column classes as necessary for QA/QC analyses in this code chunk</span></span>
<span id="cb1-1194"><a href="#cb1-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1195"><a href="#cb1-1195" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare time formats for fecal coliform &amp; TSS samples; make consistent with other formats (missing seconds)</span></span>
<span id="cb1-1196"><a href="#cb1-1196" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-1197"><a href="#cb1-1197" aria-hidden="true" tabindex="-1"></a>  <span class="co"># activity start time </span></span>
<span id="cb1-1198"><a href="#cb1-1198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_start_time =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-1199"><a href="#cb1-1199" aria-hidden="true" tabindex="-1"></a>    characteristic_name <span class="sc">==</span> <span class="st">"Fecal Coliform"</span> <span class="sc">|</span> <span class="co"># OR operator</span></span>
<span id="cb1-1200"><a href="#cb1-1200" aria-hidden="true" tabindex="-1"></a>      characteristic_name <span class="sc">==</span> <span class="st">"Total suspended solids"</span> <span class="sc">&amp;</span> </span>
<span id="cb1-1201"><a href="#cb1-1201" aria-hidden="true" tabindex="-1"></a>      sample_type <span class="sc">==</span> <span class="st">"PS"</span> <span class="sc">~</span> <span class="fu">paste0</span>(activity_start_time,<span class="st">":00"</span>),</span>
<span id="cb1-1202"><a href="#cb1-1202" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> activity_start_time)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1203"><a href="#cb1-1203" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-1204"><a href="#cb1-1204" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lab receipt time</span></span>
<span id="cb1-1205"><a href="#cb1-1205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rec_time =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-1206"><a href="#cb1-1206" aria-hidden="true" tabindex="-1"></a>    characteristic_name <span class="sc">==</span> <span class="st">"Fecal Coliform"</span> <span class="sc">&amp;</span> sample_type <span class="sc">==</span> <span class="st">"PS"</span> <span class="sc">~</span> <span class="fu">paste0</span>(rec_time,<span class="st">":00"</span>),</span>
<span id="cb1-1207"><a href="#cb1-1207" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> rec_time))</span>
<span id="cb1-1208"><a href="#cb1-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1209"><a href="#cb1-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1210"><a href="#cb1-1210" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare format for receive time of samples to lab</span></span>
<span id="cb1-1211"><a href="#cb1-1211" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-1212"><a href="#cb1-1212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rec_datetime =</span> <span class="fu">ymd_hms</span>(<span class="fu">paste</span>(rec_date, rec_time))) <span class="sc">%&gt;%</span></span>
<span id="cb1-1213"><a href="#cb1-1213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rec_date =</span> <span class="fu">date</span>(rec_datetime),</span>
<span id="cb1-1214"><a href="#cb1-1214" aria-hidden="true" tabindex="-1"></a>         <span class="at">rec_time =</span> <span class="fu">as_hms</span>(rec_datetime)) </span>
<span id="cb1-1215"><a href="#cb1-1215" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-1216"><a href="#cb1-1216" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare format for sample collection date and time</span></span>
<span id="cb1-1217"><a href="#cb1-1217" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-1218"><a href="#cb1-1218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_start_datetime =</span> <span class="fu">ymd_hms</span>(<span class="fu">paste</span>(activity_start_date,activity_start_time))) <span class="sc">%&gt;%</span></span>
<span id="cb1-1219"><a href="#cb1-1219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">activity_start_time =</span> <span class="fu">as_hms</span>(activity_start_datetime),</span>
<span id="cb1-1220"><a href="#cb1-1220" aria-hidden="true" tabindex="-1"></a>         <span class="at">activity_start_date =</span> <span class="fu">as.Date</span>(activity_start_datetime))</span>
<span id="cb1-1221"><a href="#cb1-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1222"><a href="#cb1-1222" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare format for result values</span></span>
<span id="cb1-1223"><a href="#cb1-1223" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-1224"><a href="#cb1-1224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">result_value =</span> <span class="fu">as.numeric</span>(result_value))</span>
<span id="cb1-1225"><a href="#cb1-1225" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-1226"><a href="#cb1-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1227"><a href="#cb1-1227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1228"><a href="#cb1-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1229"><a href="#cb1-1229" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2023 Data QA/QC Evaluation</span></span>
<span id="cb1-1230"><a href="#cb1-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1231"><a href="#cb1-1231" aria-hidden="true" tabindex="-1"></a>Prior to upload to the EPA WQX, all water quality data must be checked against a series of standard questions in order to evaluate how quality assurance / quality check (QA/QC) requirements are met. The draft Data Evaluation Checklist Template (available for download below) outlines these questions:</span>
<span id="cb1-1232"><a href="#cb1-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1233"><a href="#cb1-1233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = F}</span></span>
<span id="cb1-1234"><a href="#cb1-1234" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">embed_file</span>(<span class="st">'other/misc/qa_qc/Kenai_Baseline_Data_Evaluation_Checklist_2023.xlsx'</span>, <span class="at">text =</span> <span class="st">"Download 2023 Draft Kenai Baseline Data Evaluation Checklist Template"</span>)</span>
<span id="cb1-1235"><a href="#cb1-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1236"><a href="#cb1-1236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1237"><a href="#cb1-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1238"><a href="#cb1-1238" aria-hidden="true" tabindex="-1"></a>Download results pre-QA/QC; including lab QA QC info</span>
<span id="cb1-1239"><a href="#cb1-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1240"><a href="#cb1-1240" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Pre-database</span></span>
<span id="cb1-1241"><a href="#cb1-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1242"><a href="#cb1-1242" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Overall project success</span></span>
<span id="cb1-1243"><a href="#cb1-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1244"><a href="#cb1-1244" aria-hidden="true" tabindex="-1"></a>**1.) Were the appropriate analytical methods used for all parameters?**</span>
<span id="cb1-1245"><a href="#cb1-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1246"><a href="#cb1-1246" aria-hidden="true" tabindex="-1"></a>Yes. Analytical methods from the approved 2023 QAPP were employed, with certain exceptions which are not anticipated to affect results (see below).</span>
<span id="cb1-1247"><a href="#cb1-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1248"><a href="#cb1-1248" aria-hidden="true" tabindex="-1"></a>Yes. Analytical methods from the approved 2023 QAPP were employed, with exceptions (described below) that are not anticipated to affect results (see below).</span>
<span id="cb1-1249"><a href="#cb1-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1250"><a href="#cb1-1250" aria-hidden="true" tabindex="-1"></a>Changes from the approved 2023 occurred, including:</span>
<span id="cb1-1251"><a href="#cb1-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1252"><a href="#cb1-1252" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For summer 2023, a laboratory method used to analyze total metals differed slightly from that specified on the QAPP. EPA method 200.8 was used for total metals rather than 200.7. The project manager at SGS Laboratories in Anchorage, AK describes that no differences are anticipated in how results can be interpreted. Both methods are appropriate for total metals in surface waters.</span>
<span id="cb1-1253"><a href="#cb1-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1254"><a href="#cb1-1254" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1255"><a href="#cb1-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1256"><a href="#cb1-1256" aria-hidden="true" tabindex="-1"></a>**2.) Were there any deviations from the sampling plan?**</span>
<span id="cb1-1257"><a href="#cb1-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1258"><a href="#cb1-1258" aria-hidden="true" tabindex="-1"></a>In 2023 there were several small deviations from the sampling plan due to a late ice-out date and challenging spring field logistics. One site in spring 2023 could not be accessed for sampling due to low water conditions (Kenai River main stem, RM 10.1). As a result there are no samples from this site/date. Additionally, one fecal coliform sample result is missing from site RM 40 (Killey River) on 5/2/2023 due to an on-site loss from bottle spillage.</span>
<span id="cb1-1259"><a href="#cb1-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1260"><a href="#cb1-1260" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1261"><a href="#cb1-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1262"><a href="#cb1-1262" aria-hidden="true" tabindex="-1"></a>**3.) Were field duplicates, blanks, and/or other field QC samples collected as planned?**</span>
<span id="cb1-1263"><a href="#cb1-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1264"><a href="#cb1-1264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1265"><a href="#cb1-1265" aria-hidden="true" tabindex="-1"></a><span class="co"># lets look at this question from a few perspectives</span></span>
<span id="cb1-1266"><a href="#cb1-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1267"><a href="#cb1-1267" aria-hidden="true" tabindex="-1"></a><span class="co"># qa samples count table A</span></span>
<span id="cb1-1268"><a href="#cb1-1268" aria-hidden="true" tabindex="-1"></a>qa_samples1 <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb1-1269"><a href="#cb1-1269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(activity_start_date,activity_type,characteristic_name,result_analytical_method_id,sample_type, result_sample_fraction) <span class="sc">%&gt;%</span></span>
<span id="cb1-1270"><a href="#cb1-1270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-1271"><a href="#cb1-1271" aria-hidden="true" tabindex="-1"></a>    <span class="co"># filter out LABORATORY QA/QC results</span></span>
<span id="cb1-1272"><a href="#cb1-1272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(activity_start_date),</span>
<span id="cb1-1273"><a href="#cb1-1273" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(activity_type)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1274"><a href="#cb1-1274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(characteristic_name, activity_type) <span class="sc">%&gt;%</span></span>
<span id="cb1-1275"><a href="#cb1-1275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sample_type <span class="sc">==</span> <span class="st">"PS"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-1276"><a href="#cb1-1276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(activity_start_date,characteristic_name,result_analytical_method_id, result_sample_fraction)</span>
<span id="cb1-1277"><a href="#cb1-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1278"><a href="#cb1-1278" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(qa_samples1,<span class="st">"other/output/2023/qa_qc_output/qa_samples_2023_table1.csv"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb1-1279"><a href="#cb1-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1280"><a href="#cb1-1280" aria-hidden="true" tabindex="-1"></a><span class="co"># write file</span></span>
<span id="cb1-1281"><a href="#cb1-1281" aria-hidden="true" tabindex="-1"></a>dir_a <span class="ot">&lt;-</span> <span class="st">"other/output/2023/qa_qc_output/qa_qc_sample_count_a.csv"</span></span>
<span id="cb1-1282"><a href="#cb1-1282" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(qa_samples1, dir_a, <span class="at">row.names =</span> F)</span>
<span id="cb1-1283"><a href="#cb1-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1284"><a href="#cb1-1284" aria-hidden="true" tabindex="-1"></a><span class="co"># qa samples count table B</span></span>
<span id="cb1-1285"><a href="#cb1-1285" aria-hidden="true" tabindex="-1"></a>qa_samples2 <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb1-1286"><a href="#cb1-1286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(activity_start_date,result_analytical_method_id,sample_type) <span class="sc">%&gt;%</span></span>
<span id="cb1-1287"><a href="#cb1-1287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-1288"><a href="#cb1-1288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sample_type <span class="sc">==</span> <span class="st">"PS"</span>)</span>
<span id="cb1-1289"><a href="#cb1-1289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1290"><a href="#cb1-1290" aria-hidden="true" tabindex="-1"></a><span class="co"># write file</span></span>
<span id="cb1-1291"><a href="#cb1-1291" aria-hidden="true" tabindex="-1"></a>dir_b <span class="ot">&lt;-</span> <span class="st">"other/output/2023/qa_qc_output/qa_samples_2023_table2.csv"</span></span>
<span id="cb1-1292"><a href="#cb1-1292" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(qa_samples2,dir_b, <span class="at">row.names =</span> F)</span>
<span id="cb1-1293"><a href="#cb1-1293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1294"><a href="#cb1-1294" aria-hidden="true" tabindex="-1"></a><span class="fu">embed_file</span>(<span class="st">"other/output/2023/qa_qc_output/qa_samples_2023_table1.csv"</span>, <span class="at">text =</span> <span class="st">"Download count table of 2023 field duplicates, blanks, and/or other field QC samples"</span>)</span>
<span id="cb1-1295"><a href="#cb1-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1296"><a href="#cb1-1296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1297"><a href="#cb1-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1298"><a href="#cb1-1298" aria-hidden="true" tabindex="-1"></a>Yes, all planned field blanks, trip blanks, and duplicate samples were collected as planned. See the two downloadable tables below for further details on sample types and analysis types for all 2023 samples:</span>
<span id="cb1-1299"><a href="#cb1-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1300"><a href="#cb1-1300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1301"><a href="#cb1-1301" aria-hidden="true" tabindex="-1"></a><span class="fu">embed_file</span>(dir_a,<span class="at">name =</span> <span class="st">"2023 QA/QC Samples Table A"</span>)</span>
<span id="cb1-1302"><a href="#cb1-1302" aria-hidden="true" tabindex="-1"></a><span class="fu">embed_file</span>(dir_b,<span class="at">name =</span> <span class="st">"2023 QA/QC Samples Table B"</span>)</span>
<span id="cb1-1303"><a href="#cb1-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1304"><a href="#cb1-1304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1305"><a href="#cb1-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1306"><a href="#cb1-1306" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1307"><a href="#cb1-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1308"><a href="#cb1-1308" aria-hidden="true" tabindex="-1"></a>**4.) Do the laboratory reports provide results for all sites and parameters?**</span>
<span id="cb1-1309"><a href="#cb1-1309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1310"><a href="#cb1-1310" aria-hidden="true" tabindex="-1"></a>The laboratory reports from both labs provide results corresponding with the chain of custody documents provided, within the parameters of what is described in questions #1 - #3.</span>
<span id="cb1-1311"><a href="#cb1-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1312"><a href="#cb1-1312" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1313"><a href="#cb1-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1314"><a href="#cb1-1314" aria-hidden="true" tabindex="-1"></a>**5.) Is a copy of the COC included with the laboratory reports?**</span>
<span id="cb1-1315"><a href="#cb1-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1316"><a href="#cb1-1316" aria-hidden="true" tabindex="-1"></a>Yes. Chain of custody documents from SGS laboratories are included in the results PDFs linked above. Chain of custody documents from the Soldotna Wastewater Treatment Plant are linked below:</span>
<span id="cb1-1317"><a href="#cb1-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1318"><a href="#cb1-1318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1319"><a href="#cb1-1319" aria-hidden="true" tabindex="-1"></a><span class="fu">embed_file</span>(<span class="st">"other/misc/qa_qc/chain_of_custody_2023/swwtp CoC summer 2023.zip"</span>, <span class="at">text =</span> <span class="st">"Download 2023 Chain of Custody Documents from Soldotna Wastewater Treatment Plant"</span>)</span>
<span id="cb1-1320"><a href="#cb1-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1321"><a href="#cb1-1321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1322"><a href="#cb1-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1323"><a href="#cb1-1323" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1324"><a href="#cb1-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1325"><a href="#cb1-1325" aria-hidden="true" tabindex="-1"></a>**6.) Do the laboratory reports match the COC and requested methods throughout?**</span>
<span id="cb1-1326"><a href="#cb1-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1327"><a href="#cb1-1327" aria-hidden="true" tabindex="-1"></a>Yes, with the exceptions discussed in question #1.</span>
<span id="cb1-1328"><a href="#cb1-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1329"><a href="#cb1-1329" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1330"><a href="#cb1-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1331"><a href="#cb1-1331" aria-hidden="true" tabindex="-1"></a>**7.) Are the number of samples on the laboratory reports the same as on the COC?**</span>
<span id="cb1-1332"><a href="#cb1-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1333"><a href="#cb1-1333" aria-hidden="true" tabindex="-1"></a>Yes, no loss of samples occurred in the process of generating laboratory results.</span>
<span id="cb1-1334"><a href="#cb1-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1335"><a href="#cb1-1335" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1336"><a href="#cb1-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1337"><a href="#cb1-1337" aria-hidden="true" tabindex="-1"></a>**8.) Was all supporting info provided in the laboratory report, such as reporting limits for all analyses and definitions?**</span>
<span id="cb1-1338"><a href="#cb1-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1339"><a href="#cb1-1339" aria-hidden="true" tabindex="-1"></a>SGS laboratory reports include reporting limits in both the electronic data deliverables as well as the PDF reports. Results from the Soldotna Wastewater Treatment Plant do not contain reporting limits. Reporting limits and other QA/QC data considerations are provided in the 2023 QAPP.</span>
<span id="cb1-1340"><a href="#cb1-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1341"><a href="#cb1-1341" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1342"><a href="#cb1-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1343"><a href="#cb1-1343" aria-hidden="true" tabindex="-1"></a>**9.) Are site names, dates, and times correct and as expected?**</span>
<span id="cb1-1344"><a href="#cb1-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1345"><a href="#cb1-1345" aria-hidden="true" tabindex="-1"></a>Numerous corrections to site names and dates were necessary to prepare data into final form. Original documents (Electronic Data Deliverables) were not modified, and corrections are applied throughout the data read-in process using R coding script embedded in this document.</span>
<span id="cb1-1346"><a href="#cb1-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1347"><a href="#cb1-1347" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1348"><a href="#cb1-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1349"><a href="#cb1-1349" aria-hidden="true" tabindex="-1"></a>**10.) Were there any issues with instrument calibration?**</span>
<span id="cb1-1350"><a href="#cb1-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1351"><a href="#cb1-1351" aria-hidden="true" tabindex="-1"></a>No issues are documented with calibration for KWF's field or laboratory instruments. No calibration issues are described in the "Case Narrative" sections of the spring and summer SGS PDF laboratory reports.</span>
<span id="cb1-1352"><a href="#cb1-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1353"><a href="#cb1-1353" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1354"><a href="#cb1-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1355"><a href="#cb1-1355" aria-hidden="true" tabindex="-1"></a>**11.) Did the instrument perform as expected?**</span>
<span id="cb1-1356"><a href="#cb1-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1357"><a href="#cb1-1357" aria-hidden="true" tabindex="-1"></a>TBD with KWF lab results. (Check ranges to decide if including conductivity &amp; turbidity results)</span>
<span id="cb1-1358"><a href="#cb1-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1359"><a href="#cb1-1359" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1360"><a href="#cb1-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1361"><a href="#cb1-1361" aria-hidden="true" tabindex="-1"></a>**12.) Was instrument calibration performed according to the QAPP and instrument recommendations?**</span>
<span id="cb1-1362"><a href="#cb1-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1363"><a href="#cb1-1363" aria-hidden="true" tabindex="-1"></a>Yes.</span>
<span id="cb1-1364"><a href="#cb1-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1365"><a href="#cb1-1365" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1366"><a href="#cb1-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1367"><a href="#cb1-1367" aria-hidden="true" tabindex="-1"></a>**13.) Was instrument verification during the field season performed according to the QAPP and instrument recommendations?**</span>
<span id="cb1-1368"><a href="#cb1-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1369"><a href="#cb1-1369" aria-hidden="true" tabindex="-1"></a>For water temperature probes, instrument verification rather than calibration is performed. An ice-bath test was performed on all water temperature probes according to methods described in <span class="co">[</span><span class="ot">@mauger2015</span><span class="co">]</span> prior to field use, and all probes recorded values within 0.25 degrees Celsius of a NIST certified thermometer.</span>
<span id="cb1-1370"><a href="#cb1-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1371"><a href="#cb1-1371" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1372"><a href="#cb1-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1373"><a href="#cb1-1373" aria-hidden="true" tabindex="-1"></a>**14.) Were instrument calibration verification logs or records kept?**</span>
<span id="cb1-1374"><a href="#cb1-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1375"><a href="#cb1-1375" aria-hidden="true" tabindex="-1"></a>Yes. Calibration and verification records are kept at Kenai Watershed Forum's office at 44129 Sterling Hwy, Soldotna, AK and are available upon request.</span>
<span id="cb1-1376"><a href="#cb1-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1377"><a href="#cb1-1377" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1378"><a href="#cb1-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1379"><a href="#cb1-1379" aria-hidden="true" tabindex="-1"></a>**15.) Do the instrument data files site IDs, time stamps and file names match?**</span>
<span id="cb1-1380"><a href="#cb1-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1381"><a href="#cb1-1381" aria-hidden="true" tabindex="-1"></a>Instrument data files from fieldwork are not generated as part of this project.</span>
<span id="cb1-1382"><a href="#cb1-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1383"><a href="#cb1-1383" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1384"><a href="#cb1-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1385"><a href="#cb1-1385" aria-hidden="true" tabindex="-1"></a>**16.) Is any in-situ field data rejected and why?**</span>
<span id="cb1-1386"><a href="#cb1-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1387"><a href="#cb1-1387" aria-hidden="true" tabindex="-1"></a>No, no in-situ field data is rejected. Water temperature was the sole parameter measured in-situ in 2023. Other applicable intrinsic water quality parameters were measured in the KWF Office (pH, conductivity, turbidity).</span>
<span id="cb1-1388"><a href="#cb1-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1389"><a href="#cb1-1389" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1390"><a href="#cb1-1390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1391"><a href="#cb1-1391" aria-hidden="true" tabindex="-1"></a>**17.) Were preservation, hold time, and temperature requirements met?**</span>
<span id="cb1-1392"><a href="#cb1-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1393"><a href="#cb1-1393" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1394"><a href="#cb1-1394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1395"><a href="#cb1-1395" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate hold times</span></span>
<span id="cb1-1396"><a href="#cb1-1396" aria-hidden="true" tabindex="-1"></a>hold_times <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb1-1397"><a href="#cb1-1397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hold_time =</span> <span class="fu">as_hms</span>(rec_datetime <span class="sc">-</span> activity_start_datetime)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1398"><a href="#cb1-1398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hold_time_minutes =</span> <span class="fu">as.numeric</span>(<span class="fu">seconds</span>(hold_time))<span class="sc">/</span><span class="dv">60</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-1399"><a href="#cb1-1399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hold_time_hours =</span> hold_time_minutes<span class="sc">/</span><span class="dv">60</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-1400"><a href="#cb1-1400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sample_type <span class="sc">==</span> <span class="st">"PS"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-1401"><a href="#cb1-1401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>hold_time,<span class="sc">-</span>hold_time_minutes)</span>
<span id="cb1-1402"><a href="#cb1-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1403"><a href="#cb1-1403" aria-hidden="true" tabindex="-1"></a><span class="co"># read in max hold times</span></span>
<span id="cb1-1404"><a href="#cb1-1404" aria-hidden="true" tabindex="-1"></a>sample_holding_times <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"other/misc/qa_qc/sample_holding_times.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-1405"><a href="#cb1-1405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(max_holding_time_hours)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1406"><a href="#cb1-1406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(<span class="at">max_holding_time_hours =</span> <span class="fu">as.numeric</span>(max_holding_time_hours)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1407"><a href="#cb1-1407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>max_holding_time_text)</span>
<span id="cb1-1408"><a href="#cb1-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1409"><a href="#cb1-1409" aria-hidden="true" tabindex="-1"></a>hold_times <span class="ot">&lt;-</span> <span class="fu">left_join</span>(hold_times,sample_holding_times) <span class="sc">%&gt;%</span></span>
<span id="cb1-1410"><a href="#cb1-1410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hold_time_pass =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-1411"><a href="#cb1-1411" aria-hidden="true" tabindex="-1"></a>    max_holding_time_hours <span class="sc">&lt;</span> hold_time_hours <span class="sc">~</span> <span class="st">"N"</span>,</span>
<span id="cb1-1412"><a href="#cb1-1412" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Y"</span>)) </span>
<span id="cb1-1413"><a href="#cb1-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1414"><a href="#cb1-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1415"><a href="#cb1-1415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1416"><a href="#cb1-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1417"><a href="#cb1-1417" aria-hidden="true" tabindex="-1"></a>We calculated time from sample field collection to lab receipt as documented in 2023 lab reports. All 2023 samples were within holding times specified in the QAPP.</span>
<span id="cb1-1418"><a href="#cb1-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1419"><a href="#cb1-1419" aria-hidden="true" tabindex="-1"></a>In the field, all samples were stored in coolers with ice packs at 4 degrees C until arrival at the laboratory. In the results from SGS laboratories, two individual observations include the asterisk "<span class="sc">\*</span>" in the "result_qualifier" column. This indicates that "the sample was warm when received." These observations correspond not to sample handling in the field and delivery to the laboratories, but rather to internal laboratory procedures used for method blank measurements. The laboratory case narrative does not indicate that any individual sample results would be affected.</span>
<span id="cb1-1420"><a href="#cb1-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1421"><a href="#cb1-1421" aria-hidden="true" tabindex="-1"></a>Hold time result calculations are available in the downloadable table below in the right-most columns.</span>
<span id="cb1-1422"><a href="#cb1-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1423"><a href="#cb1-1423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1424"><a href="#cb1-1424" aria-hidden="true" tabindex="-1"></a>hold_times_dir <span class="ot">&lt;-</span> <span class="st">"other/output/2023/qa_qc_output/hold_times_2023.csv"</span></span>
<span id="cb1-1425"><a href="#cb1-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1426"><a href="#cb1-1426" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(hold_times,hold_times_dir, <span class="at">row.names =</span> F)</span>
<span id="cb1-1427"><a href="#cb1-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1428"><a href="#cb1-1428" aria-hidden="true" tabindex="-1"></a><span class="fu">embed_file</span>(hold_times_dir, <span class="at">text =</span> <span class="st">"Download 2023 kenai River Baseline Water Quality Samples Hold Times"</span>)</span>
<span id="cb1-1429"><a href="#cb1-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1430"><a href="#cb1-1430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1431"><a href="#cb1-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1432"><a href="#cb1-1432" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1433"><a href="#cb1-1433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1434"><a href="#cb1-1434" aria-hidden="true" tabindex="-1"></a>**18.) Are dissolved metal quantities less than total metals quantities?**</span>
<span id="cb1-1435"><a href="#cb1-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1436"><a href="#cb1-1436" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1437"><a href="#cb1-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1438"><a href="#cb1-1438" aria-hidden="true" tabindex="-1"></a><span class="co"># choose characteristics</span></span>
<span id="cb1-1439"><a href="#cb1-1439" aria-hidden="true" tabindex="-1"></a>metals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Calcium"</span>,<span class="st">"Iron"</span>,<span class="st">"Magnesium"</span>,<span class="st">"Copper"</span>,<span class="st">"Zinc"</span>)</span>
<span id="cb1-1440"><a href="#cb1-1440" aria-hidden="true" tabindex="-1"></a>cols1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"activity_id"</span>,<span class="st">"characteristic_name"</span>, <span class="st">"activity_start_date"</span>, <span class="st">"activity_type"</span>, <span class="st">"monitoring_location_id"</span>,<span class="st">"result_sample_fraction"</span>, <span class="st">"result_value"</span>,<span class="st">"result_unit"</span>)</span>
<span id="cb1-1441"><a href="#cb1-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1442"><a href="#cb1-1442" aria-hidden="true" tabindex="-1"></a>dat_metals <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb1-1443"><a href="#cb1-1443" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select field observations only</span></span>
<span id="cb1-1444"><a href="#cb1-1444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sample_type <span class="sc">==</span> <span class="st">"PS"</span>,</span>
<span id="cb1-1445"><a href="#cb1-1445" aria-hidden="true" tabindex="-1"></a>         characteristic_name <span class="sc">%in%</span> metals) <span class="sc">%&gt;%</span></span>
<span id="cb1-1446"><a href="#cb1-1446" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select relevant columns</span></span>
<span id="cb1-1447"><a href="#cb1-1447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(cols1)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1448"><a href="#cb1-1448" aria-hidden="true" tabindex="-1"></a>  <span class="co"># designate column to identify field blanks and field duplicates</span></span>
<span id="cb1-1449"><a href="#cb1-1449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">field_sample_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-1450"><a href="#cb1-1450" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"FB"</span>, activity_id) <span class="sc">~</span> <span class="st">"FB"</span>,</span>
<span id="cb1-1451"><a href="#cb1-1451" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"DUP"</span>, activity_id) <span class="sc">~</span> <span class="st">"DUP"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1452"><a href="#cb1-1452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>activity_id)</span>
<span id="cb1-1453"><a href="#cb1-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1454"><a href="#cb1-1454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1455"><a href="#cb1-1455" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co"> that analytical method ID is not included in the above dataframe. This is because in summer 2023, 200.8 was used for both total AND dissolved metals. May choose to modify in future templates</span></span>
<span id="cb1-1456"><a href="#cb1-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1457"><a href="#cb1-1457" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataframes of filtered vs unfiltered (dissolved vs total)</span></span>
<span id="cb1-1458"><a href="#cb1-1458" aria-hidden="true" tabindex="-1"></a><span class="co"># unfiltered (total)</span></span>
<span id="cb1-1459"><a href="#cb1-1459" aria-hidden="true" tabindex="-1"></a>dat_metals_tot <span class="ot">&lt;-</span> dat_metals <span class="sc">%&gt;%</span></span>
<span id="cb1-1460"><a href="#cb1-1460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(result_sample_fraction <span class="sc">==</span> <span class="st">"Unfiltered"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-1461"><a href="#cb1-1461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">result_value_total =</span> result_value,</span>
<span id="cb1-1462"><a href="#cb1-1462" aria-hidden="true" tabindex="-1"></a>         <span class="at">result_unit_total =</span> result_unit) <span class="sc">%&gt;%</span></span>
<span id="cb1-1463"><a href="#cb1-1463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>result_sample_fraction, <span class="sc">-</span>result_unit_total)</span>
<span id="cb1-1464"><a href="#cb1-1464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1465"><a href="#cb1-1465" aria-hidden="true" tabindex="-1"></a><span class="co"># filtered (dissolved)</span></span>
<span id="cb1-1466"><a href="#cb1-1466" aria-hidden="true" tabindex="-1"></a>dat_metals_diss <span class="ot">&lt;-</span> dat_metals <span class="sc">%&gt;%</span></span>
<span id="cb1-1467"><a href="#cb1-1467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(result_sample_fraction <span class="sc">==</span> <span class="st">"Filtered, lab"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-1468"><a href="#cb1-1468" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">result_value_dissolved =</span> result_value,</span>
<span id="cb1-1469"><a href="#cb1-1469" aria-hidden="true" tabindex="-1"></a>           <span class="at">result_unit_dissolved =</span> result_unit) <span class="sc">%&gt;%</span></span>
<span id="cb1-1470"><a href="#cb1-1470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>result_sample_fraction, <span class="sc">-</span>result_unit_dissolved)</span>
<span id="cb1-1471"><a href="#cb1-1471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1472"><a href="#cb1-1472" aria-hidden="true" tabindex="-1"></a><span class="co"># results here fit the lego-join, but if correct, at least 50% of instances show diss &gt; tot. check back in pdfs.</span></span>
<span id="cb1-1473"><a href="#cb1-1473" aria-hidden="true" tabindex="-1"></a>dat_metals_diss_tot <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(dat_metals_tot,dat_metals_diss,</span>
<span id="cb1-1474"><a href="#cb1-1474" aria-hidden="true" tabindex="-1"></a>                <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"characteristic_name"</span>,<span class="st">"activity_start_date"</span>,</span>
<span id="cb1-1475"><a href="#cb1-1475" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"monitoring_location_id"</span>,<span class="st">"field_sample_type"</span>,<span class="st">"activity_type"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1476"><a href="#cb1-1476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-1477"><a href="#cb1-1477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(monitoring_location_id,characteristic_name) <span class="sc">%&gt;%</span></span>
<span id="cb1-1478"><a href="#cb1-1478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">result_unit =</span> <span class="st">"ug/l"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-1479"><a href="#cb1-1479" aria-hidden="true" tabindex="-1"></a>  <span class="co"># are dissolved metals lower that total metals?</span></span>
<span id="cb1-1480"><a href="#cb1-1480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tot_less_diss =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-1481"><a href="#cb1-1481" aria-hidden="true" tabindex="-1"></a>    result_value_total <span class="sc">&gt;</span> result_value_dissolved <span class="sc">~</span> <span class="st">"Y"</span>,</span>
<span id="cb1-1482"><a href="#cb1-1482" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"N"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1483"><a href="#cb1-1483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(tot_less_diss)</span>
<span id="cb1-1484"><a href="#cb1-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1485"><a href="#cb1-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1486"><a href="#cb1-1486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1487"><a href="#cb1-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1488"><a href="#cb1-1488" aria-hidden="true" tabindex="-1"></a>Dissolved metals observations are ***not*** consistently lower that total metals observations in 2023 data. For 2023 results, a total of 52 instances exist where dissolved metals observations are paired with total metals observations. These consist exclusively of copper and zinc observations. Of the the 52 paired observations, in 32 instances dissolved metals values are greater than total metals values.</span>
<span id="cb1-1489"><a href="#cb1-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1490"><a href="#cb1-1490" aria-hidden="true" tabindex="-1"></a>These results will have important implications for data-flagging decisions as final results are prepared for upload to the EPA Water Quality Exchange.</span>
<span id="cb1-1491"><a href="#cb1-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1492"><a href="#cb1-1492" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1493"><a href="#cb1-1493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1494"><a href="#cb1-1494" aria-hidden="true" tabindex="-1"></a>**19.) Are the duplicate sample(s) RPD within range described in QAPP?**</span>
<span id="cb1-1495"><a href="#cb1-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1496"><a href="#cb1-1496" aria-hidden="true" tabindex="-1"></a>In 2023, field duplicate samples were collected at two sites on both 5/2/2023 and 7/18/2023:</span>
<span id="cb1-1497"><a href="#cb1-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1498"><a href="#cb1-1498" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>5/2/2023</span>
<span id="cb1-1499"><a href="#cb1-1499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1500"><a href="#cb1-1500" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Kenai City Docks (RM 1.5) (ID #10000002)</span>
<span id="cb1-1501"><a href="#cb1-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1502"><a href="#cb1-1502" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Moose River (RM 36.0) (ID #10000026)</span>
<span id="cb1-1503"><a href="#cb1-1503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1504"><a href="#cb1-1504" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>7/18/2023</span>
<span id="cb1-1505"><a href="#cb1-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1506"><a href="#cb1-1506" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>No Name Creek (RM 00.0) (ID #10000008)</span>
<span id="cb1-1507"><a href="#cb1-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1508"><a href="#cb1-1508" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Moose River (RM 36.0) (ID #10000026)</span>
<span id="cb1-1509"><a href="#cb1-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1510"><a href="#cb1-1510" aria-hidden="true" tabindex="-1"></a>Only results that are meaningfully representative of the physical sample may be used for RPD calculations. Following the example in the Alaska Department of Environmental Conservation 2021 Kenai River Metals Field Report <span class="co">[</span><span class="ot">@apsens2022</span><span class="co">]</span>: “… a set of paired samples was evaluated for RPD only if:</span>
<span id="cb1-1511"><a href="#cb1-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1512"><a href="#cb1-1512" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>a.) one or both of the samples were above the Limit of Quantitation (LOQ); AND if</span>
<span id="cb1-1513"><a href="#cb1-1513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1514"><a href="#cb1-1514" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>b.) one or both of the samples were at least two times the LOQ.”</span>
<span id="cb1-1515"><a href="#cb1-1515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1516"><a href="#cb1-1516" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1517"><a href="#cb1-1517" aria-hidden="true" tabindex="-1"></a><span class="co"># what are the randomly-chosen duplicate sample sites for spring &amp; summer of this year?</span></span>
<span id="cb1-1518"><a href="#cb1-1518" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="st">"other/input/2023/misc/dup_sites.csv"</span></span>
<span id="cb1-1519"><a href="#cb1-1519" aria-hidden="true" tabindex="-1"></a>dup_sites <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb1-1520"><a href="#cb1-1520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"DUP"</span>,activity_id)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1521"><a href="#cb1-1521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(monitoring_location_id,activity_start_date)</span>
<span id="cb1-1522"><a href="#cb1-1522" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(dup_sites,dir, <span class="at">row.names =</span> F)</span>
<span id="cb1-1523"><a href="#cb1-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1524"><a href="#cb1-1524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1525"><a href="#cb1-1525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1526"><a href="#cb1-1526" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1527"><a href="#cb1-1527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1528"><a href="#cb1-1528" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate limitations on what can and can't be used for RPD calculations: are samples are above LOQ and/or 2xLOQ?</span></span>
<span id="cb1-1529"><a href="#cb1-1529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1530"><a href="#cb1-1530" aria-hidden="true" tabindex="-1"></a><span class="co"># check if script conforms to following:</span></span>
<span id="cb1-1531"><a href="#cb1-1531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1532"><a href="#cb1-1532" aria-hidden="true" tabindex="-1"></a><span class="co"># does this pair of measurements meet criteria that allow them to be used for RPD calculations?</span></span>
<span id="cb1-1533"><a href="#cb1-1533" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1.) one or both of the measurements must be above the parameter's limit of quantitation (LOQ), AND</span></span>
<span id="cb1-1534"><a href="#cb1-1534" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2.) one or both of the measurements must be at least two times the LOQ."</span></span>
<span id="cb1-1535"><a href="#cb1-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1536"><a href="#cb1-1536" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-1537"><a href="#cb1-1537" aria-hidden="true" tabindex="-1"></a>  <span class="co"># do units match for detection limits and result values?</span></span>
<span id="cb1-1538"><a href="#cb1-1538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unit_match =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-1539"><a href="#cb1-1539" aria-hidden="true" tabindex="-1"></a>    result_detection_limit_unit_1 <span class="sc">==</span> result_unit <span class="sc">~</span> <span class="st">"Y"</span>,</span>
<span id="cb1-1540"><a href="#cb1-1540" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"N"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1541"><a href="#cb1-1541" aria-hidden="true" tabindex="-1"></a>  <span class="co"># are result values greater than LOQ?</span></span>
<span id="cb1-1542"><a href="#cb1-1542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">loq_pass =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-1543"><a href="#cb1-1543" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(result_detection_limit_value_1) <span class="sc">&lt;</span> result_value <span class="sc">~</span> <span class="st">"Y"</span>,</span>
<span id="cb1-1544"><a href="#cb1-1544" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"N"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1545"><a href="#cb1-1545" aria-hidden="true" tabindex="-1"></a>  <span class="co"># are result values greater than 2xLOQ?</span></span>
<span id="cb1-1546"><a href="#cb1-1546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">2xloq_pass</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb1-1547"><a href="#cb1-1547" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(result_detection_limit_value_1)<span class="sc">*</span><span class="dv">2</span> <span class="sc">&lt;</span> result_value <span class="sc">~</span> <span class="st">"Y"</span>,</span>
<span id="cb1-1548"><a href="#cb1-1548" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"N"</span>))</span>
<span id="cb1-1549"><a href="#cb1-1549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1550"><a href="#cb1-1550" aria-hidden="true" tabindex="-1"></a><span class="co"># before addressing the "one or both" questions, we need to re-arrange the table so that qc sample pairs results are side-by-side </span></span>
<span id="cb1-1551"><a href="#cb1-1551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1552"><a href="#cb1-1552" aria-hidden="true" tabindex="-1"></a><span class="co"># specifiy columns to retain</span></span>
<span id="cb1-1553"><a href="#cb1-1553" aria-hidden="true" tabindex="-1"></a>cols1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"activity_id"</span>,</span>
<span id="cb1-1554"><a href="#cb1-1554" aria-hidden="true" tabindex="-1"></a>           <span class="st">"monitoring_location_id"</span>,</span>
<span id="cb1-1555"><a href="#cb1-1555" aria-hidden="true" tabindex="-1"></a>           <span class="st">"activity_start_date"</span>,</span>
<span id="cb1-1556"><a href="#cb1-1556" aria-hidden="true" tabindex="-1"></a>           <span class="st">"characteristic_name"</span>,</span>
<span id="cb1-1557"><a href="#cb1-1557" aria-hidden="true" tabindex="-1"></a>           <span class="st">"result_value"</span>,</span>
<span id="cb1-1558"><a href="#cb1-1558" aria-hidden="true" tabindex="-1"></a>           <span class="st">"result_unit"</span>,</span>
<span id="cb1-1559"><a href="#cb1-1559" aria-hidden="true" tabindex="-1"></a>           <span class="st">"result_qualifier"</span>,</span>
<span id="cb1-1560"><a href="#cb1-1560" aria-hidden="true" tabindex="-1"></a>           <span class="st">"result_sample_fraction"</span>,</span>
<span id="cb1-1561"><a href="#cb1-1561" aria-hidden="true" tabindex="-1"></a>           <span class="st">"loq_pass"</span>,</span>
<span id="cb1-1562"><a href="#cb1-1562" aria-hidden="true" tabindex="-1"></a>           <span class="st">"2xloq_pass"</span>)</span>
<span id="cb1-1563"><a href="#cb1-1563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1564"><a href="#cb1-1564" aria-hidden="true" tabindex="-1"></a><span class="co"># add loq value &amp; name here ?!</span></span>
<span id="cb1-1565"><a href="#cb1-1565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1566"><a href="#cb1-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1567"><a href="#cb1-1567" aria-hidden="true" tabindex="-1"></a><span class="co"># develop dataframe with duplicate values arranged side-by-side</span></span>
<span id="cb1-1568"><a href="#cb1-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1569"><a href="#cb1-1569" aria-hidden="true" tabindex="-1"></a><span class="co"># subset sampling events with duplicate samples</span></span>
<span id="cb1-1570"><a href="#cb1-1570" aria-hidden="true" tabindex="-1"></a>dup_values <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb1-1571"><a href="#cb1-1571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(dup_sites) <span class="sc">%&gt;%</span></span>
<span id="cb1-1572"><a href="#cb1-1572" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reduce dataframe to relevant columns</span></span>
<span id="cb1-1573"><a href="#cb1-1573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(cols1))</span>
<span id="cb1-1574"><a href="#cb1-1574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1575"><a href="#cb1-1575" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange dup values side by side </span></span>
<span id="cb1-1576"><a href="#cb1-1576" aria-hidden="true" tabindex="-1"></a>dup_vals1 <span class="ot">&lt;-</span> dup_values <span class="sc">%&gt;%</span></span>
<span id="cb1-1577"><a href="#cb1-1577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"DUP"</span>,activity_id)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1578"><a href="#cb1-1578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">result_value1 =</span> result_value,</span>
<span id="cb1-1579"><a href="#cb1-1579" aria-hidden="true" tabindex="-1"></a>         <span class="at">result_qualifier1 =</span> result_qualifier,</span>
<span id="cb1-1580"><a href="#cb1-1580" aria-hidden="true" tabindex="-1"></a>         <span class="at">loq_pass1 =</span> loq_pass,</span>
<span id="cb1-1581"><a href="#cb1-1581" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">2xloq_pass1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">2xloq_pass</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-1582"><a href="#cb1-1582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>activity_id)</span>
<span id="cb1-1583"><a href="#cb1-1583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1584"><a href="#cb1-1584" aria-hidden="true" tabindex="-1"></a>dup_vals2 <span class="ot">&lt;-</span> dup_values <span class="sc">%&gt;%</span></span>
<span id="cb1-1585"><a href="#cb1-1585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"DUP"</span>,activity_id)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1586"><a href="#cb1-1586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>activity_id)</span>
<span id="cb1-1587"><a href="#cb1-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1588"><a href="#cb1-1588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1589"><a href="#cb1-1589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1590"><a href="#cb1-1590" aria-hidden="true" tabindex="-1"></a><span class="co"># join tables and calculate RPDs</span></span>
<span id="cb1-1591"><a href="#cb1-1591" aria-hidden="true" tabindex="-1"></a>dup_diffs <span class="ot">&lt;-</span> <span class="fu">left_join</span>(dup_vals2,dup_vals1) <span class="sc">%&gt;%</span></span>
<span id="cb1-1592"><a href="#cb1-1592" aria-hidden="true" tabindex="-1"></a>  <span class="co"># determine if pair of values is eligible to calculate RPD</span></span>
<span id="cb1-1593"><a href="#cb1-1593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1594"><a href="#cb1-1594" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1.) are one or both [at least one] of the measurements must be above the parameter's (LOQ)</span></span>
<span id="cb1-1595"><a href="#cb1-1595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">loq_both_pass =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-1596"><a href="#cb1-1596" aria-hidden="true" tabindex="-1"></a>    loq_pass <span class="sc">==</span> <span class="st">"Y"</span> <span class="sc">|</span> loq_pass1 <span class="sc">==</span> <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Y"</span>,</span>
<span id="cb1-1597"><a href="#cb1-1597" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"N"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1598"><a href="#cb1-1598" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2.) AND, one or both [at least one] of the measurements must be at least two times the LOQ."</span></span>
<span id="cb1-1599"><a href="#cb1-1599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">2xloq_both_pass</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb1-1600"><a href="#cb1-1600" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">2xloq_pass</span><span class="st">`</span> <span class="sc">==</span> <span class="st">"Y"</span> <span class="sc">|</span> <span class="st">`</span><span class="at">2xloq_pass1</span><span class="st">`</span> <span class="sc">==</span> <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Y"</span>,</span>
<span id="cb1-1601"><a href="#cb1-1601" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"N"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1602"><a href="#cb1-1602" aria-hidden="true" tabindex="-1"></a>  <span class="co"># are both of the above numbered statements true?</span></span>
<span id="cb1-1603"><a href="#cb1-1603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rpd_eligible =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-1604"><a href="#cb1-1604" aria-hidden="true" tabindex="-1"></a>    loq_both_pass <span class="sc">==</span> <span class="st">"Y"</span> <span class="sc">|</span> <span class="st">`</span><span class="at">2xloq_both_pass</span><span class="st">`</span> <span class="sc">==</span> <span class="st">"Y"</span> <span class="sc">~</span> <span class="st">"Y"</span>,</span>
<span id="cb1-1605"><a href="#cb1-1605" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"N"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1606"><a href="#cb1-1606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rpd_pct =</span> <span class="fu">abs</span>((result_value <span class="sc">-</span> result_value1)<span class="sc">/</span>result_value1)<span class="sc">*</span><span class="dv">100</span>) </span>
<span id="cb1-1607"><a href="#cb1-1607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1608"><a href="#cb1-1608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1609"><a href="#cb1-1609" aria-hidden="true" tabindex="-1"></a><span class="co"># the table currently includes all instances where both observation values are zero. does this follow the rules?</span></span>
<span id="cb1-1610"><a href="#cb1-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1611"><a href="#cb1-1611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1612"><a href="#cb1-1612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1613"><a href="#cb1-1613" aria-hidden="true" tabindex="-1"></a>A csv file of Relative Percent Difference values organized by site, date, and parameter may be downloaded below:</span>
<span id="cb1-1614"><a href="#cb1-1614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1615"><a href="#cb1-1615" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1616"><a href="#cb1-1616" aria-hidden="true" tabindex="-1"></a><span class="co"># export &amp; publish dup_diffs csv</span></span>
<span id="cb1-1617"><a href="#cb1-1617" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="st">"other/output/2023/qa_qc_output/rpd_pct_2023.csv"</span></span>
<span id="cb1-1618"><a href="#cb1-1618" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(dup_diffs, dir, <span class="at">row.names =</span> F)</span>
<span id="cb1-1619"><a href="#cb1-1619" aria-hidden="true" tabindex="-1"></a><span class="fu">embed_file</span>(dir, <span class="at">text =</span> <span class="st">"Relative Percent Difference Values for Duplicate Sample Observations, 2023"</span>)</span>
<span id="cb1-1620"><a href="#cb1-1620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1621"><a href="#cb1-1621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1622"><a href="#cb1-1622" aria-hidden="true" tabindex="-1"></a>Nomenclature note: "Limit of Quantitation (LOQ)", as used by ADEC and SGS, is equivalent to another term used by EPA CDX, "Lower Quantitation Limit," which is used in this assessment. A memo from SGS detailing nomenclature and interpretation of reporting limits can be downloaded at the link below:</span>
<span id="cb1-1623"><a href="#cb1-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1624"><a href="#cb1-1624" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1625"><a href="#cb1-1625" aria-hidden="true" tabindex="-1"></a><span class="fu">embed_file</span>(<span class="st">"other/misc/docs/DL, LOD, LOQ Interpretation.pdf"</span>)</span>
<span id="cb1-1626"><a href="#cb1-1626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1627"><a href="#cb1-1627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1628"><a href="#cb1-1628" aria-hidden="true" tabindex="-1"></a>*Discussion on 2023 Relative Percent Difference (RPD) Values* In 2023, we had a total of 23 pairs (out of 44 total pairs) of instances where parameter observations met the Limit of Quantitation (LOQ) criteria described above. In all other cases, the paired observations did not meet criteria for inclusion in RPD analyses.</span>
<span id="cb1-1629"><a href="#cb1-1629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1630"><a href="#cb1-1630" aria-hidden="true" tabindex="-1"></a>Among the 23 value pairs included in RPD analyses, RPD values ranged from 0% to 45.6%. A total of five eligible value pairs exceeded 20% RPD, all of which were from the spring sampling event (5/2/2023). Each of the parameters that constitute the five RPD exceedences have another paired observation where RPD does not exceed 20%. This suggests that the variability among replicate samples is not systematic, and is likely associated with individual crew sampling techniques. Thus, at this stage we will not exclude any specific results based on RPD analyses.</span>
<span id="cb1-1631"><a href="#cb1-1631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1632"><a href="#cb1-1632" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1633"><a href="#cb1-1633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1634"><a href="#cb1-1634" aria-hidden="true" tabindex="-1"></a>**20.) Were there any laboratory discrepancies, errors, data qualifiers, or QC failures (review laboratory duplicates, matrix spikes and blanks)?**</span>
<span id="cb1-1635"><a href="#cb1-1635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1636"><a href="#cb1-1636" aria-hidden="true" tabindex="-1"></a>Yes, there were. They are listed below:</span>
<span id="cb1-1637"><a href="#cb1-1637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1638"><a href="#cb1-1638" aria-hidden="true" tabindex="-1"></a>*Laboratory discrepancies, errors*</span>
<span id="cb1-1639"><a href="#cb1-1639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1640"><a href="#cb1-1640" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sample collection date</span>
<span id="cb1-1641"><a href="#cb1-1641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1642"><a href="#cb1-1642" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The SGS PDF report shows some samples as collected on 5/3/2022. All spring field samples were in fact collected on 5/2/2023, and none on 5/3/2023. An error of pre-printed dates on page 1 of the SGS chain of custody was responsible for this error. We applied the time/date correction as part of the data read-in script integrated into this document.</span>
<span id="cb1-1643"><a href="#cb1-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1644"><a href="#cb1-1644" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sample receipt time/date to SGS laboratories</span>
<span id="cb1-1645"><a href="#cb1-1645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1646"><a href="#cb1-1646" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The SGS Electronic Data Deliverable (EDD; spreadsheet) of results shows 5/9/2023 as the receival date for all spring project samples (sample_type = "PS"), and time of day is not specified. However, the PDF report for these same results indicates all samples were in fact received on 5/04/23 08:51, which is consistent with the chain of custody docs. We applied the time/date correction as part of the intake script.</span>
<span id="cb1-1647"><a href="#cb1-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1648"><a href="#cb1-1648" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Field site names</span>
<span id="cb1-1649"><a href="#cb1-1649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1650"><a href="#cb1-1650" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Both of the laboratory's results contained miscellaneous spellings and formats of site names that were inconsistent with of the needs of preparing data for the EPA CDX. These were corrected in the intake script by use of matching tables csv files, which can be viewed in the project GitHub repository under the directory"other/input/2023/misc".</span>
<span id="cb1-1651"><a href="#cb1-1651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1652"><a href="#cb1-1652" aria-hidden="true" tabindex="-1"></a>*Data qualifiers, QC failures (review laboratory duplicates, matrix spikes and blanks)*</span>
<span id="cb1-1653"><a href="#cb1-1653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1654"><a href="#cb1-1654" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Data qualifiers</span>
<span id="cb1-1655"><a href="#cb1-1655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1656"><a href="#cb1-1656" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Two instances of internal laboratory QC checks report, "sample was warm when received," for one matrix spike duplicate (copper) and one method blank (zinc). While these data qualifiers do not affect the result of any individual field observations, it may be important to note this qualifier in the context of interpreting laboratory data for copper and zinc.</span>
<span id="cb1-1657"><a href="#cb1-1657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1658"><a href="#cb1-1658" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>QC failures</span>
<span id="cb1-1659"><a href="#cb1-1659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1660"><a href="#cb1-1660" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>No lab QC failures are reported from Soldotna Wastewater Treatment Plant for fecal coliform or total suspended solids</span>
<span id="cb1-1661"><a href="#cb1-1661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1662"><a href="#cb1-1662" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Lab QC failures are listed on Listed on page 2 of the spring and summer SGS PDF reports</span>
<span id="cb1-1663"><a href="#cb1-1663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1664"><a href="#cb1-1664" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Spring 2023</span>
<span id="cb1-1665"><a href="#cb1-1665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1666"><a href="#cb1-1666" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Zinc: Two dissolved zinc method blanks (200.8) (MB) are above the Limit of Quantitation of 10.0 ug/L. One method blank (MB) is at 11.3 ug/L, the other at 15.9 ug/L. **As a result, dissolved zinc results from spring 2023 may need to be flagged for QC failure.** PLAN: review 2021 ADEC report.</span>
<span id="cb1-1667"><a href="#cb1-1667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1668"><a href="#cb1-1668" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>Total Nitrate/Nitrite: One matrix spike duplicate sample for total nitrate/nitrite is outside of QC criteria. The range of permissible recovery values includes the range from 90% - 110%, and the value is listed at 89%. This QC failure does not suggest a mechanism by which sample values are not still broadly representative of environmental conditions, and will not result in spring 2023 total nitrate/nitrate values being flagged for QC failure.</span>
<span id="cb1-1669"><a href="#cb1-1669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1670"><a href="#cb1-1670" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Summer 2023</span>
<span id="cb1-1671"><a href="#cb1-1671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1672"><a href="#cb1-1672" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>One matrix spike sample for total nitrate/nitrite is outside of QC criteria. The range of permissible recovery values includes the range from 90% - 110%, and the value is listed at 112%. This QC failure does not suggest a mechanism by which sample values are not still broadly representative of environmental conditions, and will not result in spring 2023 total nitrate/nitrate values being flagged for QC failure.</span>
<span id="cb1-1673"><a href="#cb1-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1674"><a href="#cb1-1674" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1675"><a href="#cb1-1675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1676"><a href="#cb1-1676" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 21.) Is any laboratory data rejected (flagged) and why? <span class="sc">\*\*</span></span>
<span id="cb1-1677"><a href="#cb1-1677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1678"><a href="#cb1-1678" aria-hidden="true" tabindex="-1"></a>Based on the above discussion, as of 6/5/2024 ***we will be flagging 2023 dissolved copper and zinc results*** as not representative of in-situ environmental conditions. The primary QA/QC not of concern for these two parameters is that a) dissolved metals values were frequently greater than total metals values, which is not physically realistic. Detections of dissolved zinc in the pring 2023 method blanks also indicate that some dissolved zinc samples may not be representative of environmental conditions.</span>
<span id="cb1-1679"><a href="#cb1-1679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1680"><a href="#cb1-1680" aria-hidden="true" tabindex="-1"></a>With this decision, a total of 60 observations are flagged (30 dissolved Cu and 30 dissolved Zn observations).</span>
<span id="cb1-1681"><a href="#cb1-1681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1682"><a href="#cb1-1682" aria-hidden="true" tabindex="-1"></a>Diagnosis is in progress of this issue for future sampling events (2024 and beyond) and QAPP updates.</span>
<span id="cb1-1683"><a href="#cb1-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1684"><a href="#cb1-1684" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1685"><a href="#cb1-1685" aria-hidden="true" tabindex="-1"></a><span class="co"># flag parameters based on discussion in question #21</span></span>
<span id="cb1-1686"><a href="#cb1-1686" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span></span>
<span id="cb1-1687"><a href="#cb1-1687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">flag =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-1688"><a href="#cb1-1688" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"Copper|Zinc"</span>,characteristic_name) <span class="sc">&amp;</span> result_sample_fraction <span class="sc">==</span> <span class="st">"Filtered, lab"</span> <span class="sc">~</span> <span class="st">"Y"</span>,</span>
<span id="cb1-1689"><a href="#cb1-1689" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb1-1690"><a href="#cb1-1690" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb1-1691"><a href="#cb1-1691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1692"><a href="#cb1-1692" aria-hidden="true" tabindex="-1"></a><span class="co"># inquiry to EPA CDX - is it best practices to flag bad results, or just exclude them all together?</span></span>
<span id="cb1-1693"><a href="#cb1-1693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1694"><a href="#cb1-1694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1695"><a href="#cb1-1695" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1696"><a href="#cb1-1696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1697"><a href="#cb1-1697" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 22.) During the field season, review raw data files (EDDs, instrument records) as they are received. Document changes and corrections to methods as needed. <span class="sc">\*\*</span></span>
<span id="cb1-1698"><a href="#cb1-1698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1699"><a href="#cb1-1699" aria-hidden="true" tabindex="-1"></a>Changes and corrections to EDDs are documented and described throughout this series of questions.</span>
<span id="cb1-1700"><a href="#cb1-1700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1701"><a href="#cb1-1701" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1702"><a href="#cb1-1702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1703"><a href="#cb1-1703" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 23.) Is the dataset complete and did you receive the expected number of results? <span class="sc">\*\*</span></span>
<span id="cb1-1704"><a href="#cb1-1704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1705"><a href="#cb1-1705" aria-hidden="true" tabindex="-1"></a>Yes, we received the anticipated number of results.</span>
<span id="cb1-1706"><a href="#cb1-1706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1707"><a href="#cb1-1707" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1708"><a href="#cb1-1708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1709"><a href="#cb1-1709" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 24.) Was the data collected representative of environmental conditions? <span class="sc">\*\*</span></span>
<span id="cb1-1710"><a href="#cb1-1710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1711"><a href="#cb1-1711" aria-hidden="true" tabindex="-1"></a>Data that is unlikely to represent environmental conditions is identified and flagged as part of this data QA/QC review process.</span>
<span id="cb1-1712"><a href="#cb1-1712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1713"><a href="#cb1-1713" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1714"><a href="#cb1-1714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1715"><a href="#cb1-1715" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 25.) Does project meet Completeness Measure A criteria? <span class="sc">\*\*</span></span>
<span id="cb1-1716"><a href="#cb1-1716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1717"><a href="#cb1-1717" aria-hidden="true" tabindex="-1"></a>From the QAPP, Completeness Measure A: “the primary number of samples collected divided by the usable number of samples submitted to ADEC, with a goal of 85% completeness.” (Note that as of 2023 results are now submitted directly to EPA rather than DEC, per request of DEC).</span>
<span id="cb1-1718"><a href="#cb1-1718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1719"><a href="#cb1-1719" aria-hidden="true" tabindex="-1"></a>From the QAPP, Completeness Measure A: "the primary number of samples collected divided by the usable number of samples submitted to ADEC, with a goal of 85% completeness." (Note that as of 2023 results are now submitted directly to EPA rather than DEC, per request of DEC).</span>
<span id="cb1-1720"><a href="#cb1-1720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1721"><a href="#cb1-1721" aria-hidden="true" tabindex="-1"></a>(Note: metals parameters not specified in the QAPP are excluded from these analyses. In 2021, SGS laboratories provided dissolved metals results for parameters beyond what was originally requested.)</span>
<span id="cb1-1722"><a href="#cb1-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1723"><a href="#cb1-1723" aria-hidden="true" tabindex="-1"></a>We calculated Completeness Measure A at the following project scales:</span>
<span id="cb1-1724"><a href="#cb1-1724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1725"><a href="#cb1-1725" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>As a project whole</span>
<span id="cb1-1726"><a href="#cb1-1726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1727"><a href="#cb1-1727" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1728"><a href="#cb1-1728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1729"><a href="#cb1-1729" aria-hidden="true" tabindex="-1"></a><span class="co"># need to have data flagging decisions complete to answer this</span></span>
<span id="cb1-1730"><a href="#cb1-1730" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb1-1731"><a href="#cb1-1731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(flag)</span>
<span id="cb1-1732"><a href="#cb1-1732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1733"><a href="#cb1-1733" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1734"><a href="#cb1-1734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1735"><a href="#cb1-1735" aria-hidden="true" tabindex="-1"></a>60 of 1280 total observations are flagged, resulting in a Completeness Measure A value of 95.3%.</span>
<span id="cb1-1736"><a href="#cb1-1736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1737"><a href="#cb1-1737" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1738"><a href="#cb1-1738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1739"><a href="#cb1-1739" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 26.) Does project meet Completeness Measure B criteria? <span class="sc">\*\*</span></span>
<span id="cb1-1740"><a href="#cb1-1740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1741"><a href="#cb1-1741" aria-hidden="true" tabindex="-1"></a>From the QAPP, Completeness Measure B: "the planned number of samples divided by the useable samples (submitted to ADEC) with a goal of 60%."</span>
<span id="cb1-1742"><a href="#cb1-1742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1743"><a href="#cb1-1743" aria-hidden="true" tabindex="-1"></a>For these calculations, we will consider "usable" as "unflagged," and will calculate at the following scales:</span>
<span id="cb1-1744"><a href="#cb1-1744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1745"><a href="#cb1-1745" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>As a project whole</span>
<span id="cb1-1746"><a href="#cb1-1746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1747"><a href="#cb1-1747" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1748"><a href="#cb1-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1749"><a href="#cb1-1749" aria-hidden="true" tabindex="-1"></a><span class="co"># need to have flagging decisions complete to do this calculation</span></span>
<span id="cb1-1750"><a href="#cb1-1750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1751"><a href="#cb1-1751" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1752"><a href="#cb1-1752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1753"><a href="#cb1-1753" aria-hidden="true" tabindex="-1"></a>As noted in question #2, one site (RM 10.1) was not visited in spring 2023, and in addition one fecal coliform sample was not collected in spring 2023. These planned sample constitute a total of</span>
<span id="cb1-1754"><a href="#cb1-1754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1755"><a href="#cb1-1755" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1756"><a href="#cb1-1756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1757"><a href="#cb1-1757" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 27.) Was the QA Officer consulted for any data concerns? <span class="sc">\*\*</span></span>
<span id="cb1-1758"><a href="#cb1-1758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1759"><a href="#cb1-1759" aria-hidden="true" tabindex="-1"></a>Kenai Watershed Forum consulted with staff from the Alaska Department of Environmental Conservation and EPA Region 10 Office in order to prepare 2023 field data and confirm field methods and data QA/QC procedures.</span>
<span id="cb1-1760"><a href="#cb1-1760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1761"><a href="#cb1-1761" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1762"><a href="#cb1-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1763"><a href="#cb1-1763" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Database Prep</span></span>
<span id="cb1-1764"><a href="#cb1-1764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1765"><a href="#cb1-1765" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 28.) Are the correct monitoring locations associated with the project? <span class="sc">\*\*</span></span>
<span id="cb1-1766"><a href="#cb1-1766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1767"><a href="#cb1-1767" aria-hidden="true" tabindex="-1"></a>We used the leaflet package to generate a map of unique sites from the 2023 dataset:</span>
<span id="cb1-1768"><a href="#cb1-1768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1769"><a href="#cb1-1769" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F, message=FALSE}</span></span>
<span id="cb1-1770"><a href="#cb1-1770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1771"><a href="#cb1-1771" aria-hidden="true" tabindex="-1"></a><span class="co"># read in locations from exported data (export_dat)</span></span>
<span id="cb1-1772"><a href="#cb1-1772" aria-hidden="true" tabindex="-1"></a>site_check <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb1-1773"><a href="#cb1-1773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(monitoring_location_id,activity_latitude,activity_longitude) <span class="sc">%&gt;%</span></span>
<span id="cb1-1774"><a href="#cb1-1774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>() </span>
<span id="cb1-1775"><a href="#cb1-1775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1776"><a href="#cb1-1776" aria-hidden="true" tabindex="-1"></a><span class="co"># generate map</span></span>
<span id="cb1-1777"><a href="#cb1-1777" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb1-1778"><a href="#cb1-1778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1779"><a href="#cb1-1779" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(site_check) <span class="sc">%&gt;%</span></span>
<span id="cb1-1780"><a href="#cb1-1780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-1781"><a href="#cb1-1781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addMarkers</span>(<span class="sc">~</span>activity_longitude,<span class="sc">~</span>activity_latitude,</span>
<span id="cb1-1782"><a href="#cb1-1782" aria-hidden="true" tabindex="-1"></a>             <span class="at">popup =</span> <span class="sc">~</span><span class="fu">as.character</span>(monitoring_location_id),</span>
<span id="cb1-1783"><a href="#cb1-1783" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="sc">~</span><span class="fu">as.character</span>(monitoring_location_id))</span>
<span id="cb1-1784"><a href="#cb1-1784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1785"><a href="#cb1-1785" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1786"><a href="#cb1-1786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1787"><a href="#cb1-1787" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1788"><a href="#cb1-1788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1789"><a href="#cb1-1789" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 29.) Are the QAPP and other supporting documents attached? <span class="sc">\*\*</span></span>
<span id="cb1-1790"><a href="#cb1-1790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1791"><a href="#cb1-1791" aria-hidden="true" tabindex="-1"></a>The 2023 QAPP is available to download at the link below, and will be attached in the upload to EPA CDX:</span>
<span id="cb1-1792"><a href="#cb1-1792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1793"><a href="#cb1-1793" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1794"><a href="#cb1-1794" aria-hidden="true" tabindex="-1"></a><span class="fu">embed_file</span>(<span class="st">"other/misc/docs/KenaiWatershedForum_QAPP_v3_2023.pdf"</span>)</span>
<span id="cb1-1795"><a href="#cb1-1795" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1796"><a href="#cb1-1796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1797"><a href="#cb1-1797" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1798"><a href="#cb1-1798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1799"><a href="#cb1-1799" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 30.) Is all metadata correct? <span class="sc">\*\*</span></span>
<span id="cb1-1800"><a href="#cb1-1800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1801"><a href="#cb1-1801" aria-hidden="true" tabindex="-1"></a>TKA</span>
<span id="cb1-1802"><a href="#cb1-1802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1803"><a href="#cb1-1803" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1804"><a href="#cb1-1804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1805"><a href="#cb1-1805" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 31.) Is the organization ID correct? <span class="sc">\*\*</span></span>
<span id="cb1-1806"><a href="#cb1-1806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1807"><a href="#cb1-1807" aria-hidden="true" tabindex="-1"></a>Kenai Watershed Forum's Organization ID in the EPA Water Quality Exchange is "Kenai_WQX." This value is manually confirmed during the upload process.</span>
<span id="cb1-1808"><a href="#cb1-1808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1809"><a href="#cb1-1809" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1810"><a href="#cb1-1810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1811"><a href="#cb1-1811" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 32.) Are the time zones consistent and correct (AKDT in summer)? <span class="sc">\*\*</span></span>
<span id="cb1-1812"><a href="#cb1-1812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1813"><a href="#cb1-1813" aria-hidden="true" tabindex="-1"></a>Yes.</span>
<span id="cb1-1814"><a href="#cb1-1814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1815"><a href="#cb1-1815" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1816"><a href="#cb1-1816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1817"><a href="#cb1-1817" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 33.) Are all media types included? Media types appropriate to Characteristic? <span class="sc">\*\*</span></span>
<span id="cb1-1818"><a href="#cb1-1818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1819"><a href="#cb1-1819" aria-hidden="true" tabindex="-1"></a>"Water" is the only media type considered in this project. All "Characteristics" (parameters) are measured from water samples or in-situ water conditions.</span>
<span id="cb1-1820"><a href="#cb1-1820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1821"><a href="#cb1-1821" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1822"><a href="#cb1-1822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1823"><a href="#cb1-1823" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 34.) Check Sample Collection, Preparation and Preservation Methods, Thermal Preservative, Equipment ID, Activity Media. Is supporting information included and correct? <span class="sc">\*\*</span></span>
<span id="cb1-1824"><a href="#cb1-1824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1825"><a href="#cb1-1825" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1826"><a href="#cb1-1826" aria-hidden="true" tabindex="-1"></a><span class="co"># sample collection method</span></span>
<span id="cb1-1827"><a href="#cb1-1827" aria-hidden="true" tabindex="-1"></a>unique_methods <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb1-1828"><a href="#cb1-1828" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(result_analytical_method_id,result_sample_fraction,sample_container_type,sample_collection_equipment_name,thermal_preservative_used)</span>
<span id="cb1-1829"><a href="#cb1-1829" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="st">"other/misc/qa_qc/unique_methods.csv"</span></span>
<span id="cb1-1830"><a href="#cb1-1830" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(unique_methods,dir, <span class="at">row.names =</span> F)</span>
<span id="cb1-1831"><a href="#cb1-1831" aria-hidden="true" tabindex="-1"></a><span class="fu">embed_file</span>(dir, <span class="at">text =</span> <span class="st">"Download supporting info on 2023 sample collecion &amp; preservation"</span>)</span>
<span id="cb1-1832"><a href="#cb1-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1833"><a href="#cb1-1833" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1834"><a href="#cb1-1834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1835"><a href="#cb1-1835" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1836"><a href="#cb1-1836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1837"><a href="#cb1-1837" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 35.) Are all expected activity types present and are QC samples correctly identified? <span class="sc">\*\*</span></span>
<span id="cb1-1838"><a href="#cb1-1838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1839"><a href="#cb1-1839" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1840"><a href="#cb1-1840" aria-hidden="true" tabindex="-1"></a><span class="co"># generate count table</span></span>
<span id="cb1-1841"><a href="#cb1-1841" aria-hidden="true" tabindex="-1"></a>activity_types <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb1-1842"><a href="#cb1-1842" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(activity_type) <span class="sc">%&gt;%</span></span>
<span id="cb1-1843"><a href="#cb1-1843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(activity_type <span class="sc">!=</span> <span class="st">""</span>)</span>
<span id="cb1-1844"><a href="#cb1-1844" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="st">"other/misc/qa_qc/activity_types.csv"</span></span>
<span id="cb1-1845"><a href="#cb1-1845" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(activity_types,dir, <span class="at">row.names =</span> F)</span>
<span id="cb1-1846"><a href="#cb1-1846" aria-hidden="true" tabindex="-1"></a><span class="fu">embed_file</span>(dir, <span class="at">text =</span> <span class="st">"Download supporting info on 2023 activity types"</span>)</span>
<span id="cb1-1847"><a href="#cb1-1847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1848"><a href="#cb1-1848" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1849"><a href="#cb1-1849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1850"><a href="#cb1-1850" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1851"><a href="#cb1-1851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1852"><a href="#cb1-1852" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 36.) Is the Activity media subdivision filled in (if relevant)? <span class="sc">\*\*</span></span>
<span id="cb1-1853"><a href="#cb1-1853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1854"><a href="#cb1-1854" aria-hidden="true" tabindex="-1"></a>"Activity media subdivision" is solely "Surface water" in the 2023 dataset.</span>
<span id="cb1-1855"><a href="#cb1-1855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1856"><a href="#cb1-1856" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1857"><a href="#cb1-1857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1858"><a href="#cb1-1858" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 37.) For Water activity media, is the relative depth filled in? <span class="sc">\*\*</span></span>
<span id="cb1-1859"><a href="#cb1-1859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1860"><a href="#cb1-1860" aria-hidden="true" tabindex="-1"></a>Yes, all samples are listed at an approximate depth of 15 cm.</span>
<span id="cb1-1861"><a href="#cb1-1861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1862"><a href="#cb1-1862" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1863"><a href="#cb1-1863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1864"><a href="#cb1-1864" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 38.) Is the number of results for each Characteristic correct? <span class="sc">\*\*</span></span>
<span id="cb1-1865"><a href="#cb1-1865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1866"><a href="#cb1-1866" aria-hidden="true" tabindex="-1"></a>Questions #2 and #3 address this topic in detail. A summary table of the total number of observations for each characteristic is available in the downloadable table below.</span>
<span id="cb1-1867"><a href="#cb1-1867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1868"><a href="#cb1-1868" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1869"><a href="#cb1-1869" aria-hidden="true" tabindex="-1"></a><span class="co"># need to remove QA/QC analytes from here</span></span>
<span id="cb1-1870"><a href="#cb1-1870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1871"><a href="#cb1-1871" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> dat </span>
<span id="cb1-1872"><a href="#cb1-1872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1873"><a href="#cb1-1873" aria-hidden="true" tabindex="-1"></a><span class="co"># WORKING HERE</span></span>
<span id="cb1-1874"><a href="#cb1-1874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1875"><a href="#cb1-1875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1876"><a href="#cb1-1876" aria-hidden="true" tabindex="-1"></a><span class="co">#summarise</span></span>
<span id="cb1-1877"><a href="#cb1-1877" aria-hidden="true" tabindex="-1"></a>chr_num <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb1-1878"><a href="#cb1-1878" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(characteristic_name <span class="sc">!=</span> <span class="st">""</span> <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(characteristic_name)) <span class="sc">%&gt;%</span></span>
<span id="cb1-1879"><a href="#cb1-1879" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(characteristic_name, result_sample_fraction) <span class="sc">%&gt;%</span> <span class="co"># group by dissolved status too</span></span>
<span id="cb1-1880"><a href="#cb1-1880" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>() </span>
<span id="cb1-1881"><a href="#cb1-1881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1882"><a href="#cb1-1882" aria-hidden="true" tabindex="-1"></a><span class="co"># save</span></span>
<span id="cb1-1883"><a href="#cb1-1883" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="st">"other/output/2023/qa_qc_output/characteristic_count_2023.csv"</span></span>
<span id="cb1-1884"><a href="#cb1-1884" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(chr_num,dir)</span>
<span id="cb1-1885"><a href="#cb1-1885" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1886"><a href="#cb1-1886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1887"><a href="#cb1-1887" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1888"><a href="#cb1-1888" aria-hidden="true" tabindex="-1"></a><span class="co"># same directory as previous chunk</span></span>
<span id="cb1-1889"><a href="#cb1-1889" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="st">"other/output/2023/qa_qc_output/characteristic_count_2023.csv"</span></span>
<span id="cb1-1890"><a href="#cb1-1890" aria-hidden="true" tabindex="-1"></a><span class="co"># embed for download</span></span>
<span id="cb1-1891"><a href="#cb1-1891" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">embed_file</span>(dir, <span class="at">text =</span> <span class="st">"Download Observation Count by Characteristic, 2023 Kenai River Baseline Water Quality"</span>)</span>
<span id="cb1-1892"><a href="#cb1-1892" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1893"><a href="#cb1-1893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1894"><a href="#cb1-1894" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1895"><a href="#cb1-1895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1896"><a href="#cb1-1896" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 39.) Do the range of result values make sense? <span class="sc">\*\*</span></span>
<span id="cb1-1897"><a href="#cb1-1897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1898"><a href="#cb1-1898" aria-hidden="true" tabindex="-1"></a>Prior to upload to the EPA WQX, the range of results will be evaluated visually and numerically in each characteristic-specific section of the comprehensive report, relative to past results. Likely outliers will be identified and recorded in a dedicated spreadsheet (download below). Each likely outlier will have accompanying notes discussing the choice, and a decisions as to whether a more detailed statistical investigation is warranted.</span>
<span id="cb1-1899"><a href="#cb1-1899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1900"><a href="#cb1-1900" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1901"><a href="#cb1-1901" aria-hidden="true" tabindex="-1"></a><span class="co">#embed_file("other/input/outliers/baseline_outliers.xlsx", text = "Download identified potential outliers for 2023 Kenai River Baseline Water Quality data")</span></span>
<span id="cb1-1902"><a href="#cb1-1902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1903"><a href="#cb1-1903" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1904"><a href="#cb1-1904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1905"><a href="#cb1-1905" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1906"><a href="#cb1-1906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1907"><a href="#cb1-1907" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 40.) Are units correct and consistent for each parameter? <span class="sc">\*\*</span></span>
<span id="cb1-1908"><a href="#cb1-1908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1909"><a href="#cb1-1909" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = F}</span></span>
<span id="cb1-1910"><a href="#cb1-1910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1911"><a href="#cb1-1911" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb1-1912"><a href="#cb1-1912" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(characteristic_name, result_unit) <span class="sc">%&gt;%</span></span>
<span id="cb1-1913"><a href="#cb1-1913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb1-1914"><a href="#cb1-1914" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="fu">unique</span>(z<span class="sc">$</span>result_unit))</span>
<span id="cb1-1915"><a href="#cb1-1915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1916"><a href="#cb1-1916" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-1917"><a href="#cb1-1917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1918"><a href="#cb1-1918" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1919"><a href="#cb1-1919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1920"><a href="#cb1-1920" aria-hidden="true" tabindex="-1"></a><span class="sc">\*\*</span> 41.) Are detection limits and laboratory qualifiers included for analytical results? <span class="sc">\*\*</span></span>
<span id="cb1-1921"><a href="#cb1-1921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1922"><a href="#cb1-1922" aria-hidden="true" tabindex="-1"></a>Laboratory qualifiers including "J" (below limit of quantitation; is an estimate), "=", (observed value), "U" (below detection limit), and "ND" (Not Detected) are included in the column titled "result_qualifier."</span>
<span id="cb1-1923"><a href="#cb1-1923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1924"><a href="#cb1-1924" aria-hidden="true" tabindex="-1"></a>Detection limits and their corresponding units are included in columns titled "result_detection_limit_type_1" and in "result_detection_limit_unit_1" corresponding to Limit of Quanititation, and in columns titled "result_detection_limit_type_2" and "result_detection_limit_unit_2" corresponding to Method Detection Level.</span>
<span id="cb1-1925"><a href="#cb1-1925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1926"><a href="#cb1-1926" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb1-1927"><a href="#cb1-1927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1928"><a href="#cb1-1928" aria-hidden="true" tabindex="-1"></a>**42.) Are results trip blanks and/or field blanks above detection limits, and is any related data flagged as a result?**</span>
<span id="cb1-1929"><a href="#cb1-1929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1930"><a href="#cb1-1930" aria-hidden="true" tabindex="-1"></a>In summer 2023, trip blanks were included with those field crews tasked with collection water samples for hydrocarbon analyses. Sites visited by these crews include RM 1.5 - Kenai City Dock, RM 6.5 - Cunningham Park, RM 40 - Bing's Landing, and RM 43 - Upstream of Dow Island.</span>
<span id="cb1-1931"><a href="#cb1-1931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1932"><a href="#cb1-1932" aria-hidden="true" tabindex="-1"></a>(any equivalent 2023 concerns?)</span>
<span id="cb1-1933"><a href="#cb1-1933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1934"><a href="#cb1-1934" aria-hidden="true" tabindex="-1"></a>On the summer 2021 SGS chain of custody documents, BTEX trip blanks are specified for the above sites. However in the reported results, a single sample named "Trip Blank" is reported. This error resulted from a mis-communication with SGS staff.</span>
<span id="cb1-1935"><a href="#cb1-1935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1936"><a href="#cb1-1936" aria-hidden="true" tabindex="-1"></a>In this case, all hydrocarbon results in the Trip Blank are reported as below detection limit, suggesting there is not a need to flag summer 2021 hydrocarbon results.</span>
<span id="cb1-1937"><a href="#cb1-1937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1938"><a href="#cb1-1938" aria-hidden="true" tabindex="-1"></a>(true for 2023?)</span>
<span id="cb1-1939"><a href="#cb1-1939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1942"><a href="#cb1-1942" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb1-1943"><a href="#cb1-1943" aria-hidden="true" tabindex="-1"></a><span class="do">### Part E: QA/QC</span></span>
<span id="cb1-1944"><a href="#cb1-1944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1945"><a href="#cb1-1945" aria-hidden="true" tabindex="-1"></a><span class="co"># questions to add to existing list:</span></span>
<span id="cb1-1946"><a href="#cb1-1946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1947"><a href="#cb1-1947" aria-hidden="true" tabindex="-1"></a><span class="co"># # Are sample collection dates unique to the actual recorded dates?</span></span>
<span id="cb1-1948"><a href="#cb1-1948" aria-hidden="true" tabindex="-1"></a><span class="co"># (no; spring has two dates; lab typo)</span></span>
<span id="cb1-1949"><a href="#cb1-1949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1950"><a href="#cb1-1950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1951"><a href="#cb1-1951" aria-hidden="true" tabindex="-1"></a><span class="co"># are fecal coliform "0" values listed as "NA"? (they should be)</span></span>
<span id="cb1-1952"><a href="#cb1-1952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1953"><a href="#cb1-1953" aria-hidden="true" tabindex="-1"></a><span class="co"># are metals field blanks clean?</span></span>
<span id="cb1-1954"><a href="#cb1-1954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1955"><a href="#cb1-1955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-1956"><a href="#cb1-1956" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>